(function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()({1:[function(require,module,exports){
"use strict";function AdManagerDirectVideo(){this.init.apply(this,arguments)}exports.AdManagerDirectVideo=AdManagerDirectVideo;var Debug=require("../dev/Debug").Debug,SmokeSignals=require("../events/SmokeSignals").SmokeSignals,Timer=require("../util/Timer").Timer,Util=require("../util/Util").Util,VPAIDEvent=require("../vpaid/VPAIDEvent").VPAIDEvent;AdManagerDirectVideo.prototype.main,AdManagerDirectVideo.prototype.mediaFiles,AdManagerDirectVideo.prototype.adResponse,AdManagerDirectVideo.prototype.creative,AdManagerDirectVideo.prototype.adWidth,AdManagerDirectVideo.prototype.adHeight,AdManagerDirectVideo.prototype.lastVolume,AdManagerDirectVideo.prototype.lastRemainingTime,AdManagerDirectVideo.prototype.lastDuration,AdManagerDirectVideo.prototype.firstQuartileFired,AdManagerDirectVideo.prototype.midpointFired,AdManagerDirectVideo.prototype.thirdQuartileFired,AdManagerDirectVideo.prototype.streamReadyTimer,AdManagerDirectVideo.prototype.gotVideoDimensions,AdManagerDirectVideo.prototype.gotStreamReady,AdManagerDirectVideo.prototype.environmentVars,AdManagerDirectVideo.prototype.player,AdManagerDirectVideo.prototype.listeners,AdManagerDirectVideo.prototype.impressionFired,AdManagerDirectVideo.prototype.init=function(e,t,i,r){SmokeSignals.convert(this),this.main=e,this.mediaFiles=r,this.adResponse=t,this.creative=i,this.adWidth=this.main.getStageWidth(),this.adHeight=this.main.getStageHeight(),this.lastVolume=1,this.lastRemainingTime=0,this.lastDuration=0,this.firstQuartileFired=!1,this.midpointFired=!1,this.thirdQuartileFired=!1,this.streamReadyTimer=null,this.gotVideoDimensions=!1,this.gotStreamReady=!1,this.environmentVars=null,this.player=null,this.listeners={},this.impressionFired=!1},AdManagerDirectVideo.prototype.getAdLinear=function(){return!0},AdManagerDirectVideo.prototype.getAdWidth=function(){return this.adWidth},AdManagerDirectVideo.prototype.getAdHeight=function(){return this.adHeight},AdManagerDirectVideo.prototype.getAdExpanded=function(){return!1},AdManagerDirectVideo.prototype.getAdSkippableState=function(){return!1},AdManagerDirectVideo.prototype.getAdRemainingTime=function(){return null===this.player?0:this.player.duration-this.player.currentTime},AdManagerDirectVideo.prototype.getAdDuration=function(){return null===this.player?0:this.player.duration},AdManagerDirectVideo.prototype.getAdVolume=function(){return null===this.player?this.lastVolume:this.player.volume},AdManagerDirectVideo.prototype.setAdVolume=function(e){null!==this.player&&(this.player.volume=e),this.lastVolume!==e&&this.emit(VPAIDEvent.AdVolumeChange),this.lastVolume=e},AdManagerDirectVideo.prototype.getAdCompanions=function(){return""},AdManagerDirectVideo.prototype.getAdIcons=function(){return!1},AdManagerDirectVideo.prototype.handshakeVersion=function(e){return"2.0"},AdManagerDirectVideo.prototype.initAd=function(e,t,i,r,a,s){this.environmentVars=s,this.player=this.environmentVars.videoSlot,this.addVideoListenersFirstPhase();for(var n=0;n<this.mediaFiles.length;n++){var o=document.createElement("source");o.setAttribute("src",this.mediaFiles[n].url),o.setAttribute("type",this.mediaFiles[n].type),this.player.appendChild(o)}this.player.load()},AdManagerDirectVideo.prototype.resizeAd=function(e,t,i){},AdManagerDirectVideo.prototype.startAd=function(){this.main.hideLoaderForDirect(),this.addVideoListeners();try{var e=this;this.player.play().then(function(){e.player.paused&&e.player.play()}).catch(function(t){Debug.logWarn("("+e.adResponse.serverOrder+") Error calling play function on video element",t)})}catch(t){Debug.logWarn("("+e.adResponse.serverOrder+") Error calling play function on video element",t)}},AdManagerDirectVideo.prototype.addVideoListenersFirstPhase=function(){this.player.addEventListener("loadedmetadata",this.listeners.loadedmetadata=Util.bind(this.doMediaSize,this)),this.player.addEventListener("loadstart",this.listeners.loadstart=Util.bind(this.doMediaStarted,this)),this.player.addEventListener("canplay",this.listeners.canplay=Util.bind(this.doMediaStreamReady,this)),this.player.addEventListener("error",this.listeners.error=Util.bind(this.doMediaError,this)),this.player.addEventListener("durationchange",this.listeners.durationchange=Util.bind(this.doMediaDuration,this))},AdManagerDirectVideo.prototype.removeVideoListenersFirstPhase=function(){this.player.removeEventListener("loadedmetadata",this.listeners.loadedmetadata),this.player.removeEventListener("loadstart",this.listeners.loadstart),this.player.removeEventListener("canplay",this.listeners.canplay),this.player.removeEventListener("error",this.listeners.error),this.player.removeEventListener("durationchange",this.listeners.durationchange),this.listeners={}},AdManagerDirectVideo.prototype.addVideoListeners=function(){this.environmentVars.slot.addEventListener("click",this.listeners.click=Util.bind(this.onClick,this)),this.player.addEventListener("ended",this.listeners.ended=Util.bind(this.doMediaFinished,this)),this.player.addEventListener("error",this.listeners.error=Util.bind(this.doMediaError,this)),this.player.addEventListener("durationchange",this.listeners.durationchange=Util.bind(this.doMediaDuration,this)),this.player.addEventListener("timeupdate",this.listeners.timeupdate=Util.bind(this.doMediaTime,this)),this.player.addEventListener("play",this.listeners.play=Util.bind(this.onPlay,this)),this.player.addEventListener("pause",this.listeners.pause=Util.bind(this.onPause,this))},AdManagerDirectVideo.prototype.removeVideoListeners=function(){this.environmentVars.slot.removeEventListener("click",this.listeners.click),this.player.removeEventListener("ended",this.listeners.ended),this.player.removeEventListener("error",this.listeners.error),this.player.removeEventListener("durationchange",this.listeners.durationchange),this.player.removeEventListener("timeupdate",this.listeners.timeupdate),this.player.removeEventListener("play",this.listeners.play),this.player.removeEventListener("pause",this.listeners.pause),this.listeners={}},AdManagerDirectVideo.prototype.onClick=function(){if(this.player.paused)this.resumeAd();else{this.pauseAd();var e={id:"",url:"",playerHandles:!0};this.creative.videoClicksThrough.length>0&&(e.url=this.creative.videoClicksThrough[0]),this.emit(VPAIDEvent.AdClickThru,e)}},AdManagerDirectVideo.prototype.doMediaSize=function(){Debug.logInfo("("+this.adResponse.serverOrder+") Video: media dimension is "+this.player.videoWidth+"x"+this.player.videoHeight+" pixels"),this.gotVideoDimensions=!0,this.adWidth=this.player.videoWidth,this.adHeight=this.player.videoHeight,this.gotStreamReady&&(this.player.pause(),this.removeVideoListenersFirstPhase(),this.emit(VPAIDEvent.AdLoaded))},AdManagerDirectVideo.prototype.doMediaStarted=function(){Debug.logInfo("("+this.adResponse.serverOrder+") Video: media started playing"),this.streamReadyTimer=new Timer(3e3,1),this.streamReadyTimer.on(Timer.TIMER_COMPLETE,this.onStreamReadyTimeout,this),this.streamReadyTimer.start()},AdManagerDirectVideo.prototype.doMediaStreamReady=function(){this.streamReadyTimer&&(this.streamReadyTimer.off(Timer.TIMER_COMPLETE,this.onStreamReadyTimeout),this.streamReadyTimer.stop()),this.gotStreamReady=!0,Debug.logInfo("("+this.adResponse.serverOrder+") Video: media stream ready"),this.gotVideoDimensions&&(this.player.pause(),this.removeVideoListenersFirstPhase(),this.emit(VPAIDEvent.AdLoaded))},AdManagerDirectVideo.prototype.onStreamReadyTimeout=function(){this.streamReadyTimer&&(this.streamReadyTimer.off(Timer.TIMER_COMPLETE,this.onStreamReadyTimeout),this.streamReadyTimer.stop()),this.gotStreamReady=!0,Debug.logInfo("("+this.adResponse.serverOrder+") Video: media stream ready timeout. Starting video anyway."),this.gotVideoDimensions&&(this.player.pause(),this.removeVideoListenersFirstPhase(),this.emit(VPAIDEvent.AdLoaded))},AdManagerDirectVideo.prototype.doMediaFinished=function(){Debug.logInfo("("+this.adResponse.serverOrder+") Video: media finished playing"),this.removeVideoListeners(),this.emit(VPAIDEvent.AdVideoComplete),this.stopAd()},AdManagerDirectVideo.prototype.doMediaError=function(){Debug.logWarn("("+this.adResponse.serverOrder+") Video: media error while playing"),this.removeVideoListeners(),this.emit(VPAIDEvent.AdError)},AdManagerDirectVideo.prototype.doMediaDuration=function(){Debug.logInfo("("+this.adResponse.serverOrder+") Video: media is "+this.player.duration+" seconds long");var e=this.player.duration-this.player.currentTime;e!==this.lastRemainingTime&&this.emit(VPAIDEvent.AdRemainingTimeChange),this.lastRemainingTime=e,this.player.duration!==this.lastDuration&&this.emit(VPAIDEvent.AdDurationChange),this.lastDuration=this.player.duration},AdManagerDirectVideo.prototype.doMediaTime=function(){Debug.logTrace("("+this.adResponse.serverOrder+") Video: media is at "+this.player.currentTime+" seconds");var e=this.player.duration-this.player.currentTime;e!==this.lastRemainingTime&&(this.emit(VPAIDEvent.AdRemainingTimeChange),!this.firstQuartileFired&&this.player.currentTime>=this.player.duration/4&&(this.emit(VPAIDEvent.AdVideoFirstQuartile),this.firstQuartileFired=!0),!this.midpointFired&&this.player.currentTime>=this.player.duration/2&&(this.emit(VPAIDEvent.AdVideoMidpoint),this.midpointFired=!0),!this.thirdQuartileFired&&this.player.currentTime>=3*this.player.duration/4&&(this.emit(VPAIDEvent.AdVideoThirdQuartile),this.thirdQuartileFired=!0)),this.lastRemainingTime=e},AdManagerDirectVideo.prototype.onPlay=function(){this.environmentVars.playButton.classList.add("hidden"),this.impressionFired||(this.emit(VPAIDEvent.AdImpression),this.emit(VPAIDEvent.AdVideoStart),this.impressionFired=!0)},AdManagerDirectVideo.prototype.onPause=function(){this.environmentVars.playButton.classList.remove("hidden")},AdManagerDirectVideo.prototype.stopAd=function(){if(null!==this.player){for(this.player.pause();this.player.firstChild;)this.player.removeChild(this.player.firstChild);this.player=null}this.emit(VPAIDEvent.AdStopped)},AdManagerDirectVideo.prototype.pauseAd=function(){null!==this.player&&(this.player.pause(),this.emit(VPAIDEvent.AdPaused))},AdManagerDirectVideo.prototype.resumeAd=function(){null!==this.player&&(this.player.play(),this.emit(VPAIDEvent.AdPlaying))},AdManagerDirectVideo.prototype.expandAd=function(){},AdManagerDirectVideo.prototype.collapseAd=function(){},AdManagerDirectVideo.prototype.skipAd=function(){},AdManagerDirectVideo.prototype.subscribe=function(e,t,i){this.on(t,e,i)},AdManagerDirectVideo.prototype.unsubscribe=function(e,t){this.off(t,e)};
},{"../dev/Debug":7,"../events/SmokeSignals":8,"../util/Timer":15,"../util/Util":16,"../vpaid/VPAIDEvent":18}],2:[function(require,module,exports){
"use strict";function AdManagerFirstPhase(){this.init.apply(this,arguments)}exports.AdManagerFirstPhase=AdManagerFirstPhase;var AdManagerDirectVideo=require("../app/AdManagerDirectVideo").AdManagerDirectVideo,AdManagerFlashWrapper=require("../app/AdManagerFlashWrapper").AdManagerFlashWrapper,Config=require("../app/Config").Config,Debug=require("../dev/Debug").Debug,SmokeSignals=require("../events/SmokeSignals").SmokeSignals,JsLoader=require("../requests/JsLoader").JsLoader,Timer=require("../util/Timer").Timer,Util=require("../util/Util").Util,VPAIDEvent=require("../vpaid/VPAIDEvent").VPAIDEvent,VPAIDWrapper=require("../vpaid/VPAIDWrapper").VPAIDWrapper;AdManagerFirstPhase.EVENT_READY="ready",AdManagerFirstPhase.EVENT_ERROR="error",AdManagerFirstPhase.STATUS_LOADING="loading",AdManagerFirstPhase.STATUS_READY="ready",AdManagerFirstPhase.STATUS_ERROR="error",AdManagerFirstPhase.prototype.main,AdManagerFirstPhase.prototype.adResponse,AdManagerFirstPhase.prototype.creative,AdManagerFirstPhase.prototype.creativeData,AdManagerFirstPhase.prototype.adManagerLoader,AdManagerFirstPhase.prototype.startTime,AdManagerFirstPhase.prototype.endTime,AdManagerFirstPhase.prototype.startTimeLastMessage,AdManagerFirstPhase.prototype.lastMessage,AdManagerFirstPhase.prototype.adManager,AdManagerFirstPhase.prototype.timer,AdManagerFirstPhase.prototype.adStoppedCalled,AdManagerFirstPhase.prototype.status,AdManagerFirstPhase.prototype.mediaFile,AdManagerFirstPhase.prototype.cleanUpCalled,AdManagerFirstPhase.prototype.errorFired,AdManagerFirstPhase.prototype.environmentVars,AdManagerFirstPhase.prototype.volumeForceInfo,AdManagerFirstPhase.prototype.adManagerFlashWrapper,AdManagerFirstPhase.prototype.init=function(e,a){SmokeSignals.convert(this),this.main=e,this.adResponse=a,this.creative=null,this.creativeData="",this.adManagerLoader=null,this.startTime=0,this.endTime=0,this.startTimeLastMessage=0,this.lastMessage="",this.adManager=null,this.timer=null,this.adStoppedCalled=!1,this.status=AdManagerFirstPhase.STATUS_LOADING,this.mediaFiles=null,this.cleanUpCalled=!1,this.errorFired=!1,this.environmentVars={},this.volumeForceInfo=null,this.adManagerFlashWrapper=null},AdManagerFirstPhase.prototype.getElapsedTime=function(){var e=(new Date).getTime();return this.endTime>0&&(e=this.endTime),Math.floor((e-this.startTime)/1e3)},AdManagerFirstPhase.prototype.getElapsedTimeLastMessage=function(){var e=(new Date).getTime();this.endTime>0&&(e=this.endTime);var a=Math.floor((e-this.startTimeLastMessage)/1e3);return this.startTimeLastMessage=e,a},AdManagerFirstPhase.prototype.getLastMessage=function(e){var a=this.lastMessage;return this.lastMessage=e,a},AdManagerFirstPhase.prototype.init2=function(){Debug.logInfo("("+this.adResponse.serverOrder+") Starting parallel loading of ad"),this.startTime=(new Date).getTime(),this.startTimeLastMessage=this.startTime,this.lastMessage="";var e=this.adResponse.getAllSupportedCreatives();if(e.length>0){this.creative=e[0];var a=this.main.getStageWidth(),t=this.main.getStageHeight();if(0!==a&&0!==t||(a=400,t=300),this.creative.hasSupportedMediaFiles()){var i,s,r=[],n=this.creative.getProbablyPlayableMediaFiles(),d=this.creative.getMaybePlayableMediaFiles();for(s=0;s<d.length;s++)i=d[s],-1===n.indexOf(i)&&n.push(i);for(d=this.creative.getFlashPlayableMediaFiles(),s=0;s<d.length;s++)i=d[s],-1===n.indexOf(i)&&n.push(i);for(var h,s=0;s<n.length;s++)h=n[s],0===r.length?r=[h]:(h.width>=a&&h.width<r[0].width||r[0].width<a)&&(h.height>=t&&h.height<r[0].height||r[0].height<t)?r=[h]:h.width===r[0].width&&h.height===r[0].height&&r.push(h);return 0===r.length&&(r=Config.PREFER_JS?this.creative.getVPAIDMediaFiles().length>0?[this.creative.getVPAIDMediaFiles()[0]]:[this.creative.getVPAIDFlashMediaFiles()[0]]:this.creative.getVPAIDFlashMediaFiles().length>0?[this.creative.getVPAIDFlashMediaFiles()[0]]:[this.creative.getVPAIDMediaFiles()[0]]),Debug.logInfo("("+this.adResponse.serverOrder+") Playing ad in parallel ("+r[0].type+")"),this.main.forceVolumeException&&(Util.triggerOurTracking(this.adResponse,this.main.isClientMode,"FORCE_VOLUME_EXCEPTION","",this.getElapsedTime(),0),this.main.forceVolumeException=!1),void this.loadAdManager(r,this.creative.adParameters)}}this.status=AdManagerFirstPhase.STATUS_ERROR,this.emit(AdManagerFirstPhase.EVENT_ERROR,this)},AdManagerFirstPhase.prototype.loadAdManager=function(e,a){if(this.main.adStoppedExternal)return this.status=AdManagerFirstPhase.STATUS_ERROR,void this.emit(AdManagerFirstPhase.EVENT_ERROR,this);if(this.mediaFiles=e,this.creativeData=a,this.mediaFiles[0].isProbablyPlayable()||this.mediaFiles[0].isMaybePlayable()){Util.triggerOurTracking(this.adResponse,this.main.isClientMode,"JSADMANAGER_DIRECT_VIDEO",this.getLastMessage("JSADMANAGER_DIRECT_VIDEO"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.adManager=new VPAIDWrapper(new AdManagerDirectVideo(this.main,this.adResponse,this.creative,this.mediaFiles),this.main,this.adResponse,!0),this.adManager.subscribe(this.adLoaded,VPAIDEvent.AdLoaded,this),this.adManager.subscribe(this.adStopped,VPAIDEvent.AdStopped,this),this.timer=new Timer(1e3*Config.TIMEOUT_VPAID_INIT,1),this.timer.delay>0&&(this.timer.on(Timer.TIMER_COMPLETE,this.onInitAdTimeout,this),this.timer.start());var t=this.adManager.handshakeVersion("2.0");if(Debug.logInfo("("+this.adResponse.serverOrder+") Ad manager loaded, calling initAd (VPAID version: "+t+")"),Util.triggerOurTracking(this.adResponse,this.main.isClientMode,"INITAD",this.getLastMessage("INITAD"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.environmentVars.item=document.createElement("div"),this.environmentVars.item.classList.add("item"),this.environmentVars.item.classList.add("invisible"),this.main.stage.slotsContainer.appendChild(this.environmentVars.item),this.environmentVars.slot=document.createElement("div"),this.environmentVars.slot.classList.add("slot"),this.environmentVars.slot.style.cursor="pointer",this.environmentVars.item.appendChild(this.environmentVars.slot),this.environmentVars.playButton=document.createElement("div"),this.environmentVars.playButton.classList.add("playButton"),this.environmentVars.slot.appendChild(this.environmentVars.playButton),this.main.isClientMode?(this.environmentVars.videoSlot=document.createElement("video"),this.environmentVars.videoSlot.muted=Config.MUTED,this.adManager.videoSlot=this.environmentVars.videoSlot,this.environmentVars.videoSlot.classList.add("video"),this.environmentVars.item.appendChild(this.environmentVars.videoSlot)):this.environmentVars.videoSlot=this.main.environmentVars.videoSlot,Config.SHOW_CID){var i=document.createElement("div");i.classList.add("creativeIdContainer"),i.appendChild(document.createTextNode(this.adResponse.tag.cid)),this.environmentVars.item.appendChild(i)}this.adManager.initAd(this.main.width,this.main.height,this.main.viewMode,this.main.desiredBitrate,{AdParameters:this.creativeData},{slot:this.environmentVars.slot,videoSlot:this.environmentVars.videoSlot,videoSlotCanAutoPlay:!1,playButton:this.environmentVars.playButton}),this.volumeForceInfo=Util.addVideoToForce(this.environmentVars.videoSlot,this.adResponse)}else if(this.mediaFiles[0].isFlashPlayable()){if(this.adResponse.playedUsingFlashWrapper=!0,Util.triggerOurTracking(this.adResponse,this.main.isClientMode,"ADMANAGER_DIRECT_VIDEO",this.getLastMessage("ADMANAGER_DIRECT_VIDEO"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.adManagerFlashWrapper=new AdManagerFlashWrapper(this.main,this.adResponse),this.adManagerFlashWrapper.on(AdManagerFlashWrapper.READY,this.adManagerFlashWrapperLoadedHandler,this),this.adManagerFlashWrapper.on(AdManagerFlashWrapper.ERROR,this.adManagerFlashWrapperLoadFailedHandler,this),this.environmentVars.item=document.createElement("div"),this.environmentVars.item.classList.add("item"),this.environmentVars.item.classList.add("invisible"),this.main.stage.slotsContainer.appendChild(this.environmentVars.item),this.environmentVars.slot=document.createElement("div"),this.environmentVars.slot.classList.add("slot"),this.environmentVars.slot.style.cursor="pointer",this.environmentVars.item.appendChild(this.environmentVars.slot),Config.SHOW_CID){var i=document.createElement("div");i.classList.add("creativeIdContainer"),i.appendChild(document.createTextNode(this.adResponse.tag.cid)),this.environmentVars.item.appendChild(i)}this.adManagerFlashWrapper.init2(this.environmentVars)}else if(this.mediaFiles[0].isVPAID())Util.triggerOurTracking(this.adResponse,this.main.isClientMode,"JSADMANAGER_LOAD",this.getLastMessage("JSADMANAGER_LOAD"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.environmentVars.item=document.createElement("div"),this.environmentVars.item.classList.add("item"),this.environmentVars.item.classList.add("invisible"),this.main.stage.slotsContainer.appendChild(this.environmentVars.item),this.adManagerLoader=new JsLoader,this.adManagerLoader.on(JsLoader.COMPLETE,this.adManagerLoadedHandler,this),this.adManagerLoader.on(JsLoader.ERROR,this.adManagerLoadFailedHandler,this),this.adManagerLoader.on(JsLoader.TIMEOUT,this.adManagerLoadFailedHandler,this),this.adManagerLoader.load(this.environmentVars.item,this.mediaFiles[0].url);else{if(this.adResponse.playedUsingFlashWrapper=!0,Util.triggerOurTracking(this.adResponse,this.main.isClientMode,"ADMANAGER_LOAD",this.getLastMessage("ADMANAGER_LOAD"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.adManagerFlashWrapper=new AdManagerFlashWrapper(this.main,this.adResponse),this.adManagerFlashWrapper.on(AdManagerFlashWrapper.READY,this.adManagerFlashWrapperLoadedHandler,this),this.adManagerFlashWrapper.on(AdManagerFlashWrapper.ERROR,this.adManagerFlashWrapperLoadFailedHandler,this),this.environmentVars.item=document.createElement("div"),this.environmentVars.item.classList.add("item"),this.environmentVars.item.classList.add("invisible"),this.main.stage.slotsContainer.appendChild(this.environmentVars.item),this.environmentVars.slot=document.createElement("div"),this.environmentVars.slot.classList.add("slot"),this.environmentVars.slot.style.cursor="pointer",this.environmentVars.item.appendChild(this.environmentVars.slot),Config.SHOW_CID){var i=document.createElement("div");i.classList.add("creativeIdContainer"),i.appendChild(document.createTextNode(this.adResponse.tag.cid)),this.environmentVars.item.appendChild(i)}this.adManagerFlashWrapper.init2(this.environmentVars)}},AdManagerFirstPhase.prototype.adManagerLoadedHandler=function(){if(this.adManagerLoader.off(JsLoader.COMPLETE,this.adManagerLoadedHandler),this.adManagerLoader.off(JsLoader.ERROR,this.adManagerLoadFailedHandler),this.adManagerLoader.off(JsLoader.TIMEOUT,this.adManagerLoadFailedHandler),this.main.adStoppedExternal)return this.status=AdManagerFirstPhase.STATUS_ERROR,void this.emit(AdManagerFirstPhase.EVENT_ERROR,this);if(Debug.logInfo("("+this.adResponse.serverOrder+") Ad manager added to stage"),this.adManager=new VPAIDWrapper(this.adManagerLoader.iframe,this.main,this.adResponse),null===this.adManager.ad)return Util.triggerOurTracking(this.adResponse,this.main.isClientMode,"ADMANAGER_ERROR_INVALID",this.getLastMessage("ADMANAGER_ERROR_INVALID"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.errorFired=!0,this.cleanupEverything(),this.status=AdManagerFirstPhase.STATUS_ERROR,void this.emit(AdManagerFirstPhase.EVENT_ERROR,this);Config.USE_LEGACY_LOGIC&&this.main.setTrackingPixel(this.adResponse.tag.tracking,this.adResponse.tag.trackingp,"3"),this.adManager.subscribe(this.adLoaded,VPAIDEvent.AdLoaded,this),this.adManager.subscribe(this.adStopped,VPAIDEvent.AdStopped,this),this.adManager.subscribe(this.adError,VPAIDEvent.AdError,this),this.timer=new Timer(1e3*Config.TIMEOUT_VPAID_INIT,1),this.timer.delay>0&&(this.timer.on(Timer.TIMER_COMPLETE,this.onInitAdTimeout,this),this.timer.start());var e=this.adManager.handshakeVersion("2.0");if(Debug.logInfo("("+this.adResponse.serverOrder+") Ad manager loaded, calling initAd (VPAID version: "+e+")"),Util.triggerOurTracking(this.adResponse,this.main.isClientMode,"INITAD",this.getLastMessage("INITAD"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.environmentVars.slot=document.createElement("div"),this.environmentVars.slot.classList.add("slot"),this.adManagerLoader.iframe.contentDocument.body.appendChild(this.environmentVars.slot),this.main.isClientMode?(this.environmentVars.videoSlot=document.createElement("video"),this.environmentVars.videoSlot.muted=Config.MUTED,this.adManager.videoSlot=this.environmentVars.videoSlot,this.environmentVars.videoSlot.classList.add("video"),this.adManagerLoader.iframe.contentDocument.body.appendChild(this.environmentVars.videoSlot)):this.environmentVars.videoSlot=this.main.environmentVars.videoSlot,Config.SHOW_CID){var a=document.createElement("div");a.classList.add("creativeIdContainer"),a.appendChild(document.createTextNode(this.adResponse.tag.cid)),this.adManagerLoader.iframe.contentDocument.body.appendChild(a)}this.adManager.initAd(this.main.width,this.main.height,this.main.viewMode,this.main.desiredBitrate,{AdParameters:this.creativeData},{slot:this.environmentVars.slot,videoSlot:this.environmentVars.videoSlot,videoSlotCanAutoPlay:!1}),this.volumeForceInfo=Util.addVideoToForce(this.environmentVars.videoSlot,this.adResponse)},AdManagerFirstPhase.prototype.adManagerLoadFailedHandler=function(e){this.adManagerLoader.off(JsLoader.COMPLETE,this.adManagerLoadedHandler),this.adManagerLoader.off(JsLoader.ERROR,this.adManagerLoadFailedHandler),this.adManagerLoader.off(JsLoader.TIMEOUT,this.adManagerLoadFailedHandler),Util.triggerErrorTracking(this.adResponse,402),Config.USE_LEGACY_LOGIC&&this.main.setTrackingPixel(this.adResponse.tag.tracking,this.adResponse.tag.trackingp,"3","&vec=402");var a="ADMANAGER_ERROR_"+(e.type===JsLoader.ERROR?"HTTP_UNKNOWN":"TIMEOUT");Util.triggerOurTracking(this.adResponse,this.main.isClientMode,a,this.getLastMessage(a),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.errorFired=!0,this.cleanupEverything(),this.status=AdManagerFirstPhase.STATUS_ERROR,this.emit(AdManagerFirstPhase.EVENT_ERROR,this)},AdManagerFirstPhase.prototype.adManagerFlashWrapperLoadedHandler=function(){if(this.adManagerFlashWrapper.off(AdManagerFlashWrapper.READY,this.adManagerFlashWrapperLoadedHandler),this.adManagerFlashWrapper.off(AdManagerFlashWrapper.ERROR,this.adManagerFlashWrapperLoadFailedHandler),this.main.adStoppedExternal)return this.status=AdManagerFirstPhase.STATUS_ERROR,void this.emit(AdManagerFirstPhase.EVENT_ERROR,this);this.adManager=new VPAIDWrapper(this.adManagerFlashWrapper,this.main,this.adResponse,!0),this.adManager.subscribe(this.adLoaded,VPAIDEvent.AdLoaded,this),this.adManager.subscribe(this.adStopped,VPAIDEvent.AdStopped,this),this.adManager.subscribe(this.adError,VPAIDEvent.AdError,this),this.timer=new Timer(1e3*Config.TIMEOUT_VPAID_INIT,1),this.timer.delay>0&&(this.timer.on(Timer.TIMER_COMPLETE,this.onInitAdTimeout,this),this.timer.start()),this.adResponse.errors=[],this.adResponse.impressions=[];for(var e=0;e<this.adResponse.inLineLinearCreatives.length;e++){var a=this.adResponse.inLineLinearCreatives[e];a.trackingEvents=[],a.videoClicksThrough=[],a.videoClicksTracking=[],a.customVideoClicks=[]}var t=this.adManager.handshakeVersion("2.0");Debug.logInfo("("+this.adResponse.serverOrder+") Ad manager loaded, calling initAd (VPAID version: "+t+")"),Util.triggerOurTracking(this.adResponse,this.main.isClientMode,"INITAD",this.getLastMessage("INITAD"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.adManager.initAd(this.main.width,this.main.height,this.main.viewMode,this.main.desiredBitrate,"",encodeURIComponent(JSON.stringify({results:JSON.stringify(this.adResponse.results),serverOrder:this.adResponse.serverOrder,isClientMode:this.main.isClientMode})))},AdManagerFirstPhase.prototype.adManagerFlashWrapperLoadFailedHandler=function(){this.adManagerFlashWrapper.off(AdManagerFlashWrapper.READY,this.adManagerFlashWrapperLoadedHandler),this.adManagerFlashWrapper.off(AdManagerFlashWrapper.ERROR,this.adManagerFlashWrapperLoadFailedHandler),Util.triggerErrorTracking(this.adResponse,402),Config.USE_LEGACY_LOGIC&&this.main.setTrackingPixel(this.adResponse.tag.tracking,this.adResponse.tag.trackingp,"3","&vec=402"),Util.triggerOurTracking(this.adResponse,this.main.isClientMode,"ADMANAGER_ERROR_FLASH_WRAPPER",this.getLastMessage("ADMANAGER_ERROR_FLASH_WRAPPER"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.errorFired=!0,this.cleanupEverything(),this.status=AdManagerFirstPhase.STATUS_ERROR,this.emit(AdManagerFirstPhase.EVENT_ERROR,this)},AdManagerFirstPhase.prototype.log=function(e){e&&Debug.logTrace("("+this.adResponse.serverOrder+") "+e)},AdManagerFirstPhase.prototype.adLoaded=function(e){this.log(e.type),this.timer&&(this.timer.stop(),this.timer.off(Timer.TIMER_COMPLETE,this.onInitAdTimeout)),this.adManager.unsubscribe(this.adLoaded,VPAIDEvent.AdLoaded),this.endTime=(new Date).getTime(),this.status=AdManagerFirstPhase.STATUS_READY,this.emit(AdManagerFirstPhase.EVENT_READY,this)},AdManagerFirstPhase.prototype.onInitAdTimeout=function(){Debug.logWarn("("+this.adResponse.serverOrder+") InitAd timeout"),Util.triggerOurTracking(this.adResponse,this.main.isClientMode,"TO_INITAD",this.getLastMessage("TO_INITAD"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.errorFired=!0,Config.USE_LEGACY_LOGIC&&this.main.setTrackingPixel(this.adResponse.tag.tracking,this.adResponse.tag.trackingp,"1"),this.adManager.stopAd(),this.adManager.unsubscribe(this.adLoaded,VPAIDEvent.AdLoaded),this.status=AdManagerFirstPhase.STATUS_ERROR,this.emit(AdManagerFirstPhase.EVENT_ERROR,this)},AdManagerFirstPhase.prototype.adStopped=function(e){this.log(e.type),this.timer&&(this.timer.stop(),this.timer.off(Timer.TIMER_COMPLETE,this.onInitAdTimeout)),this.adManager.unsubscribe(this.adLoaded,VPAIDEvent.AdLoaded),this.adStoppedCalled||(this.adStoppedCalled=!0,Debug.logInfo("("+this.adResponse.serverOrder+") Ad manager removed from stage"),this.cleanUpCalled||this.errorFired||(Util.triggerOurTracking(this.adResponse,this.main.isClientMode,"ADMANAGER_NO_ADS_AFTER_INITAD",this.getLastMessage("ADMANAGER_NO_ADS_AFTER_INITAD"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.errorFired=!0,Config.USE_LEGACY_LOGIC&&this.main.setTrackingPixel(this.adResponse.tag.tracking,this.adResponse.tag.trackingp,"5")),this.cleanupEverything(),this.status=AdManagerFirstPhase.STATUS_ERROR,this.emit(AdManagerFirstPhase.EVENT_ERROR,this))},AdManagerFirstPhase.prototype.adError=function(e){this.log(e.type),this.errorFired||(Util.triggerErrorTracking(this.adResponse,901),Util.triggerOurTracking(this.adResponse,this.main.isClientMode,"ERROR_AFTER_INITAD",this.getLastMessage("ERROR_AFTER_INITAD"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.errorFired=!0),this.adManager.stopAd()},AdManagerFirstPhase.prototype.finishFirstPhase=function(){this.adManager&&(this.adManager.unsubscribe(this.adLoaded,VPAIDEvent.AdLoaded),this.adManager.unsubscribe(this.adStopped,VPAIDEvent.AdStopped),this.adManager.unsubscribe(this.adError,VPAIDEvent.AdError))},AdManagerFirstPhase.prototype.cleanupEverything=function(){if(this.cleanUpCalled=!0,null!==this.volumeForceInfo&&Util.removeVideoFromForce(this.volumeForceInfo),this.adManager&&this.adManager.ad&&this.adManager.stopAd(),this.environmentVars)try{null!==this.adManagerFlashWrapper&&this.adManagerFlashWrapper.cleanupEverything(),this.main.stage.slotsContainer.removeChild(this.environmentVars.item)}catch(e){}this.adManagerLoader&&this.adManagerLoader.close()};
},{"../app/AdManagerDirectVideo":1,"../app/AdManagerFlashWrapper":3,"../app/Config":5,"../dev/Debug":7,"../events/SmokeSignals":8,"../requests/JsLoader":12,"../util/Timer":15,"../util/Util":16,"../vpaid/VPAIDEvent":18,"../vpaid/VPAIDWrapper":19}],3:[function(require,module,exports){
"use strict";function AdManagerFlashWrapper(){this.init.apply(this,arguments)}exports.AdManagerFlashWrapper=AdManagerFlashWrapper;var Config=require("../app/Config").Config,Debug=require("../dev/Debug").Debug,SmokeSignals=require("../events/SmokeSignals").SmokeSignals,Timer=require("../util/Timer").Timer,Util=require("../util/Util").Util,VPAIDEvent=require("../vpaid/VPAIDEvent").VPAIDEvent;AdManagerFlashWrapper.READY="READY",AdManagerFlashWrapper.ERROR="ERROR",AdManagerFlashWrapper.prototype.main,AdManagerFlashWrapper.prototype.adResponse,AdManagerFlashWrapper.prototype.flashContainerId,AdManagerFlashWrapper.prototype.ad,AdManagerFlashWrapper.prototype.flashReadyTimer,AdManagerFlashWrapper.prototype.cleanUpCalled,AdManagerFlashWrapper.prototype.init=function(e,t){SmokeSignals.convert(this),this.main=e,this.adResponse=t,this.flashContainerId=null,this.ad=null,this.flashReadyTimer=null,this.cleanUpCalled=!1},AdManagerFlashWrapper.prototype.init2=function(e){e.slot.setAttribute("id",this.flashContainerId="flashAdManager"+this.adResponse.serverOrder),document[this.flashContainerId+"helper"]=this;var t={};for(var r in this.main.parameters)this.main.parameters.hasOwnProperty(r)&&(t[r]=this.main.parameters[r]);t.tags="SINGLE_TAG",t.timeout_vpaid_init="0",t.timeout_vpaid_impression="0",t.debug_rand=Debug.rand;var a=new Timer(100,1);a.on(Timer.TIMER_COMPLETE,function(){swfobject.embedSWF(Config.FLASH,this.flashContainerId,""+this.main.getStageWidth(),""+this.main.getStageHeight(),"10.0.0",void 0,t,{allowScriptAccess:"always",allowFullScreen:"true",wmode:"transparent"},{},Util.bind(function(e){e.success?(this.flashReadyTimer=new Timer(100,10*Config.TIMEOUT_SWF_LOADER),this.flashReadyTimer.on(Timer.TIMER,this.flashReadyTimeout,this),this.flashReadyTimer.on(Timer.TIMER_COMPLETE,this.flashReadyTimeoutLast,this),this.flashReadyTimer.start()):this.emit(AdManagerFlashWrapper.ERROR)},this))},this),a.start()},AdManagerFlashWrapper.prototype.flashReadyTimeout=function(){swfobject.getObjectById(this.flashContainerId)&&swfobject.getObjectById(this.flashContainerId).handshakeVersionEI&&(this.ad=swfobject.getObjectById(this.flashContainerId),this.flashReadyTimer.stop(),this.flashReadyTimer.off(Timer.TIMER,this.flashReadyTimeout),this.flashReadyTimer.off(Timer.TIMER_COMPLETE,this.flashReadyTimeoutLast),this.addProxyListeners(),this.emit(AdManagerFlashWrapper.READY))},AdManagerFlashWrapper.prototype.flashReadyTimeoutLast=function(){swfobject.getObjectById(this.flashContainerId)&&swfobject.getObjectById(this.flashContainerId).handshakeVersionEI?(this.ad=swfobject.getObjectById(this.flashContainerId),this.flashReadyTimer.stop(),this.flashReadyTimer.off(Timer.TIMER,this.flashReadyTimeout),this.flashReadyTimer.off(Timer.TIMER_COMPLETE,this.flashReadyTimeoutLast),this.addProxyListeners(),this.emit(AdManagerFlashWrapper.READY)):this.emit(AdManagerFlashWrapper.ERROR)},AdManagerFlashWrapper.prototype.cleanupEverything=function(){this.cleanUpCalled||(this.cleanUpCalled=!0,this.removeProxyListeners(),swfobject.removeSWF(this.flashContainerId),delete document[this.flashContainerId+"helper"])},AdManagerFlashWrapper.prototype.proxySubscribe=function(e,t){try{this.ad.subscribeEI("document."+this.flashContainerId+"helper."+e,t)}catch(e){this.main.log3rdPartyException(this.adResponse,"proxySubscribe",e)}},AdManagerFlashWrapper.prototype.proxyUnsubscribe=function(e){try{null!==this.ad&&this.ad.unsubscribeEI(e)}catch(e){this.main.log3rdPartyException(this.adResponse,"proxyUnsubscribe",e)}},AdManagerFlashWrapper.prototype.addProxyListeners=function(){this.proxySubscribe("proxyAdLoaded",VPAIDEvent.AdLoaded),this.proxySubscribe("proxyAdStarted",VPAIDEvent.AdStarted),this.proxySubscribe("proxyAdStopped",VPAIDEvent.AdStopped),this.proxySubscribe("proxyAdSkipped",VPAIDEvent.AdSkipped),this.proxySubscribe("proxyAdLinearChange",VPAIDEvent.AdLinearChange),this.proxySubscribe("proxyAdSizeChange",VPAIDEvent.AdSizeChange),this.proxySubscribe("proxyAdExpandedChange",VPAIDEvent.AdExpandedChange),this.proxySubscribe("proxyAdSkippableStateChange",VPAIDEvent.AdSkippableStateChange),this.proxySubscribe("proxyAdRemainingTimeChange",VPAIDEvent.AdRemainingTimeChange),this.proxySubscribe("proxyAdDurationChange",VPAIDEvent.AdDurationChange),this.proxySubscribe("proxyAdVolumeChange",VPAIDEvent.AdVolumeChange),this.proxySubscribe("proxyAdImpression",VPAIDEvent.AdImpression),this.proxySubscribe("proxyAdVideoStart",VPAIDEvent.AdVideoStart),this.proxySubscribe("proxyAdVideoFirstQuartile",VPAIDEvent.AdVideoFirstQuartile),this.proxySubscribe("proxyAdVideoMidpoint",VPAIDEvent.AdVideoMidpoint),this.proxySubscribe("proxyAdVideoThirdQuartile",VPAIDEvent.AdVideoThirdQuartile),this.proxySubscribe("proxyAdVideoComplete",VPAIDEvent.AdVideoComplete),this.proxySubscribe("proxyAdClickThru",VPAIDEvent.AdClickThru),this.proxySubscribe("proxyAdInteraction",VPAIDEvent.AdInteraction),this.proxySubscribe("proxyAdUserAcceptInvitation",VPAIDEvent.AdUserAcceptInvitation),this.proxySubscribe("proxyAdUserMinimize",VPAIDEvent.AdUserMinimize),this.proxySubscribe("proxyAdUserClose",VPAIDEvent.AdUserClose),this.proxySubscribe("proxyAdPaused",VPAIDEvent.AdPaused),this.proxySubscribe("proxyAdPlaying",VPAIDEvent.AdPlaying),this.proxySubscribe("proxyAdLog",VPAIDEvent.AdLog),this.proxySubscribe("proxyAdError",VPAIDEvent.AdError)},AdManagerFlashWrapper.prototype.removeProxyListeners=function(){this.proxyUnsubscribe(VPAIDEvent.AdLoaded),this.proxyUnsubscribe(VPAIDEvent.AdStarted),this.proxyUnsubscribe(VPAIDEvent.AdStopped),this.proxyUnsubscribe(VPAIDEvent.AdSkipped),this.proxyUnsubscribe(VPAIDEvent.AdLinearChange),this.proxyUnsubscribe(VPAIDEvent.AdSizeChange),this.proxyUnsubscribe(VPAIDEvent.AdExpandedChange),this.proxyUnsubscribe(VPAIDEvent.AdSkippableStateChange),this.proxyUnsubscribe(VPAIDEvent.AdRemainingTimeChange),this.proxyUnsubscribe(VPAIDEvent.AdDurationChange),this.proxyUnsubscribe(VPAIDEvent.AdVolumeChange),this.proxyUnsubscribe(VPAIDEvent.AdImpression),this.proxyUnsubscribe(VPAIDEvent.AdVideoStart),this.proxyUnsubscribe(VPAIDEvent.AdVideoFirstQuartile),this.proxyUnsubscribe(VPAIDEvent.AdVideoMidpoint),this.proxyUnsubscribe(VPAIDEvent.AdVideoThirdQuartile),this.proxyUnsubscribe(VPAIDEvent.AdVideoComplete),this.proxyUnsubscribe(VPAIDEvent.AdClickThru),this.proxyUnsubscribe(VPAIDEvent.AdInteraction),this.proxyUnsubscribe(VPAIDEvent.AdUserAcceptInvitation),this.proxyUnsubscribe(VPAIDEvent.AdUserMinimize),this.proxyUnsubscribe(VPAIDEvent.AdUserClose),this.proxyUnsubscribe(VPAIDEvent.AdPaused),this.proxyUnsubscribe(VPAIDEvent.AdPlaying),this.proxyUnsubscribe(VPAIDEvent.AdLog),this.proxyUnsubscribe(VPAIDEvent.AdError)},AdManagerFlashWrapper.prototype.proxyAdLoaded=function(){this.emit(VPAIDEvent.AdLoaded)},AdManagerFlashWrapper.prototype.proxyAdStarted=function(){this.emit(VPAIDEvent.AdStarted)},AdManagerFlashWrapper.prototype.proxyAdStopped=function(){this.emit(VPAIDEvent.AdStopped)},AdManagerFlashWrapper.prototype.proxyAdSkipped=function(){this.emit(VPAIDEvent.AdSkipped)},AdManagerFlashWrapper.prototype.proxyAdLinearChange=function(){this.emit(VPAIDEvent.AdLinearChange)},AdManagerFlashWrapper.prototype.proxyAdSizeChange=function(){this.emit(VPAIDEvent.AdSizeChange)},AdManagerFlashWrapper.prototype.proxyAdExpandedChange=function(){this.emit(VPAIDEvent.AdExpandedChange)},AdManagerFlashWrapper.prototype.proxyAdSkippableStateChange=function(){this.emit(VPAIDEvent.AdSkippableStateChange)},AdManagerFlashWrapper.prototype.proxyAdRemainingTimeChange=function(){this.emit(VPAIDEvent.AdRemainingTimeChange)},AdManagerFlashWrapper.prototype.proxyAdDurationChange=function(){this.emit(VPAIDEvent.AdDurationChange)},AdManagerFlashWrapper.prototype.proxyAdVolumeChange=function(){this.emit(VPAIDEvent.AdVolumeChange)},AdManagerFlashWrapper.prototype.proxyAdImpression=function(){this.emit(VPAIDEvent.AdImpression)},AdManagerFlashWrapper.prototype.proxyAdVideoStart=function(){this.emit(VPAIDEvent.AdVideoStart)},AdManagerFlashWrapper.prototype.proxyAdVideoFirstQuartile=function(){this.emit(VPAIDEvent.AdVideoFirstQuartile)},AdManagerFlashWrapper.prototype.proxyAdVideoMidpoint=function(){this.emit(VPAIDEvent.AdVideoMidpoint)},AdManagerFlashWrapper.prototype.proxyAdVideoThirdQuartile=function(){this.emit(VPAIDEvent.AdVideoThirdQuartile)},AdManagerFlashWrapper.prototype.proxyAdVideoComplete=function(){this.emit(VPAIDEvent.AdVideoComplete)},AdManagerFlashWrapper.prototype.proxyAdClickThru=function(e){this.emit(VPAIDEvent.AdClickThru,e&&e.data)},AdManagerFlashWrapper.prototype.proxyAdInteraction=function(){this.emit(VPAIDEvent.AdInteraction)},AdManagerFlashWrapper.prototype.proxyAdUserAcceptInvitation=function(){this.emit(VPAIDEvent.AdUserAcceptInvitation)},AdManagerFlashWrapper.prototype.proxyAdUserMinimize=function(){this.emit(VPAIDEvent.AdUserMinimize)},AdManagerFlashWrapper.prototype.proxyAdUserClose=function(){this.emit(VPAIDEvent.AdUserClose)},AdManagerFlashWrapper.prototype.proxyAdPaused=function(){this.emit(VPAIDEvent.AdPaused)},AdManagerFlashWrapper.prototype.proxyAdPlaying=function(){this.emit(VPAIDEvent.AdPlaying)},AdManagerFlashWrapper.prototype.proxyAdLog=function(){this.emit(VPAIDEvent.AdLog)},AdManagerFlashWrapper.prototype.proxyAdError=function(){this.emit(VPAIDEvent.AdError)},AdManagerFlashWrapper.prototype.getAdLinear=function(){return this.ad.getAdLinearEI()},AdManagerFlashWrapper.prototype.getAdWidth=function(){return this.ad.getAdWidthEI()},AdManagerFlashWrapper.prototype.getAdHeight=function(){return this.ad.getAdHeightEI()},AdManagerFlashWrapper.prototype.getAdExpanded=function(){return this.ad.getAdExpandedEI()},AdManagerFlashWrapper.prototype.getAdSkippableState=function(){return this.ad.getAdSkippableStateEI()},AdManagerFlashWrapper.prototype.getAdRemainingTime=function(){return this.ad.getAdRemainingTimeEI()},AdManagerFlashWrapper.prototype.getAdDuration=function(){return this.ad.getAdDurationEI()},AdManagerFlashWrapper.prototype.getAdVolume=function(){return this.ad.getAdVolumeEI()},AdManagerFlashWrapper.prototype.setAdVolume=function(e){this.ad.setAdVolumeEI(e)},AdManagerFlashWrapper.prototype.getAdCompanions=function(){return this.ad.getAdCompanionsEI()},AdManagerFlashWrapper.prototype.getAdIcons=function(){return this.ad.getAdIconsEI()},AdManagerFlashWrapper.prototype.handshakeVersion=function(e){return this.ad.handshakeVersionEI(e)},AdManagerFlashWrapper.prototype.initAd=function(e,t,r,a,i,n){this.ad.initAdEI(e,t,r,a,i,n)},AdManagerFlashWrapper.prototype.resizeAd=function(e,t,r){this.ad.resizeAdEI(e,t,r)},AdManagerFlashWrapper.prototype.startAd=function(){this.ad.startAdEI()},AdManagerFlashWrapper.prototype.stopAd=function(){this.ad.stopAdEI()},AdManagerFlashWrapper.prototype.pauseAd=function(){this.ad.pauseAdEI()},AdManagerFlashWrapper.prototype.resumeAd=function(){this.ad.resumeAdEI()},AdManagerFlashWrapper.prototype.expandAd=function(){this.ad.expandAdEI()},AdManagerFlashWrapper.prototype.collapseAd=function(){this.ad.collapseAdEI()},AdManagerFlashWrapper.prototype.skipAd=function(){this.ad.skipAdEI()},AdManagerFlashWrapper.prototype.subscribe=function(e,t,r){this.on(t,e,r)},AdManagerFlashWrapper.prototype.unsubscribe=function(e,t){this.off(t,e)};
},{"../app/Config":5,"../dev/Debug":7,"../events/SmokeSignals":8,"../util/Timer":15,"../util/Util":16,"../vpaid/VPAIDEvent":18}],4:[function(require,module,exports){
"use strict";function AdManagerPreloader(){this.init.apply(this,arguments)}exports.AdManagerPreloader=AdManagerPreloader;var AdManagerFirstPhase=require("../app/AdManagerFirstPhase").AdManagerFirstPhase,Config=require("../app/Config").Config,Debug=require("../dev/Debug").Debug,SmokeSignals=require("../events/SmokeSignals").SmokeSignals,AdProvider=require("../requests/AdProvider").AdProvider,AdRequestFlash=require("../requests/AdRequestFlash").AdRequestFlash;AdManagerPreloader.BEST_ADMANAGER_READY="bestAdManagerReady",AdManagerPreloader.ALL_ADMANAGERS_COMPLETE="allAdManagersComplete",AdManagerPreloader.prototype.main,AdManagerPreloader.prototype.adProvider,AdManagerPreloader.prototype.adManagersActive,AdManagerPreloader.prototype.adResponsesQueue,AdManagerPreloader.prototype.adManagersQueue,AdManagerPreloader.prototype.cleanUpCalled,AdManagerPreloader.prototype.init=function(e){SmokeSignals.convert(this),this.main=e,this.adProvider=null,this.adManagersActive=0,this.adResponsesQueue=[],this.adManagersQueue=[],this.cleanUpCalled=!1},AdManagerPreloader.prototype.init2=function(e){this.adProvider=e,this.fetchAdProviderResponses()},AdManagerPreloader.prototype.fetchAdProviderResponses=function(){if(!this.cleanUpCalled){this.adProvider.off(AdProvider.BEST_AD_READY,this.onBestAdReady),this.adProvider.off(AdProvider.ALL_REQUESTS_COMPLETE,this.onAllRequestsComplete);var e=this.adProvider.getBestAdResponse();null===e&&(this.main.adResponsesPlayed>0||this.adProvider.intermediateTimedOut)&&(e=this.adProvider.getBestCompletedAdResponse()),null===e?this.adProvider.isAllRequestsComplete()||(this.adProvider.on(AdProvider.BEST_AD_READY,this.onBestAdReady,this),this.adProvider.on(AdProvider.ALL_REQUESTS_COMPLETE,this.onAllRequestsComplete,this)):(e.alreadyProcessed=!0,this.adResponsesQueue.push(e),this.loadAdManager(),this.fetchAdProviderResponses())}},AdManagerPreloader.prototype.onBestAdReady=function(e,a){a.alreadyProcessed=!0,this.adResponsesQueue.push(a),this.loadAdManager()},AdManagerPreloader.prototype.onAllRequestsComplete=function(){AdRequestFlash.cleanupEverything(),this.fetchAdProviderResponses(),this.checkAllComplete()},AdManagerPreloader.prototype.loadAdManager=function(){var e=Config.FORCE_BUCKET_ORDER?0:1;if(!(this.adManagersActive>=Config.PARALLEL_ADMANAGERS+e||0===this.adResponsesQueue.length||this.cleanUpCalled)){var a,r,s,t=-1,n=-1,d=-1;if(this.adManagersActive===Config.PARALLEL_ADMANAGERS&&!Config.FORCE_BUCKET_ORDER){var l=!0;for(s=0;s<this.adManagersQueue.length;s++)if(a=this.adManagersQueue[s],!a.adResponse.alreadyPlayed&&(a.adResponse.getProbablyPlayableCreatives().length>0||a.adResponse.getMaybePlayableCreatives().length>0||a.adResponse.getFlashPlayableCreatives().length>0)){l=!1;break}if(l){for(n=-1,d=-1,s=0;s<this.adResponsesQueue.length;s++){if(r=this.adResponsesQueue[s],r.getProbablyPlayableCreatives().length>0){t=s;break}r.getMaybePlayableCreatives().length>0&&-1===n?n=s:r.getFlashPlayableCreatives().length>0&&-1===d&&(d=s)}-1===t&&(t=-1!==n?n:d)}if(-1===t)return}if(-1===t&&!Config.FORCE_BUCKET_ORDER){for(n=-1,d=-1,s=0;s<this.adResponsesQueue.length;s++){if(r=this.adResponsesQueue[s],r.getProbablyPlayableCreatives().length>0){t=s;break}r.getMaybePlayableCreatives().length>0&&-1===n?n=s:r.getFlashPlayableCreatives().length>0&&-1===d&&(d=s)}-1===t&&(t=-1!==n?n:d)}-1===t&&(t=0),r=this.adResponsesQueue[t],this.adResponsesQueue.splice(t,1),a=new AdManagerFirstPhase(this.main,r),this.adManagersQueue.push(a),this.adManagersQueue.sort(function(e,a){return e.adResponse.serverOrder-a.adResponse.serverOrder}),this.adManagersActive++,Debug.logWarn("("+r.serverOrder+") adManagersActive="+this.adManagersActive+" (loadAdManager)"),a.on(AdManagerFirstPhase.EVENT_READY,this.adManagerReady,this),a.on(AdManagerFirstPhase.EVENT_ERROR,this.adManagerError,this),a.init2()}},AdManagerPreloader.prototype.adManagerFinished=function(e){this.adManagersActive--,Debug.logWarn("("+e.serverOrder+") adManagersActive="+this.adManagersActive+" (adManagerFinished)"),this.loadAdManager()},AdManagerPreloader.prototype.getBestReadyAdManager=function(e){void 0===e&&(e=!1);for(var a=null,r=null,s=null,t=null,n=0;n<this.adManagersQueue.length;n++){var d=this.adManagersQueue[n];if(d.status===AdManagerFirstPhase.STATUS_READY){var l=d.adResponse;if(!l.alreadyPlayed){if(l.getProbablyPlayableCreatives().length>0)return d;l.getMaybePlayableCreatives().length>0&&null===a?a=d:l.getFlashPlayableCreatives().length>0&&null===r?r=d:!e&&l.getVPAIDCreatives().length>0&&null===s?s=d:!e&&l.getVPAIDFlashCreatives().length>0&&null===t&&(t=d)}}}return null!==a?a:null!==r?r:null!==s?s:t},AdManagerPreloader.prototype.getBestAdManager=function(){for(var e=null,a=null,r=null,s=null,t="0",n=!1,d=0;d<this.adManagersQueue.length;d++){var l=this.adManagersQueue[d];if(l.adResponse.tag.bucket!==t){if(n||null!==e||null!==a||null!==r||null!==s)break;t=l.adResponse.tag.bucket,n=!1}if(l.status===AdManagerFirstPhase.STATUS_LOADING)n=!0;else if(l.status===AdManagerFirstPhase.STATUS_READY){var i=l.adResponse;if(!i.alreadyPlayed){if(i.getProbablyPlayableCreatives().length>0)return l;i.getMaybePlayableCreatives().length>0&&null===e?e=l:i.getFlashPlayableCreatives().length>0&&null===a?a=l:i.getVPAIDCreatives().length>0&&null===r?r=l:i.getVPAIDFlashCreatives().length>0&&null===s&&(s=l)}}}if(null!==e)return e;if(null!==a)return a;var o=this.getBestReadyAdManager(!0);return null===o||Config.FORCE_BUCKET_ORDER?null!==r?r:s:o},AdManagerPreloader.prototype.allCompleteForBucket=function(e){for(var a=0;a<this.adManagersQueue.length;a++){var r=this.adManagersQueue[a];if(r.adResponse.tag.bucket===e&&r.status!==AdManagerFirstPhase.STATUS_READY)return!1}return!0},AdManagerPreloader.prototype.adManagerReady=function(e,a){a.off(AdManagerFirstPhase.EVENT_READY,this.adManagerReady),a.off(AdManagerFirstPhase.EVENT_ERROR,this.adManagerError),Debug.logInfo("("+a.adResponse.serverOrder+") Ad ready for synchronous playback");var r=this.getBestAdManager();null===r||a.adResponse.serverOrder!==r.adResponse.serverOrder&&!this.allCompleteForBucket(r.adResponse.tag.bucket)||this.emit(AdManagerPreloader.BEST_ADMANAGER_READY,r),this.checkAllComplete()},AdManagerPreloader.prototype.adManagerError=function(e,a){a.off(AdManagerFirstPhase.EVENT_READY,this.adManagerReady),a.off(AdManagerFirstPhase.EVENT_ERROR,this.adManagerError),a.adResponse.alreadyPlayed=!0,Debug.logInfo("("+a.adResponse.serverOrder+") Error while loading ad in parallel"),this.cleanUpCalled||this.main.addNoAdCreative(a.adResponse.tag.cid),this.adManagersActive--,Debug.logWarn("("+a.adResponse.serverOrder+") adManagersActive="+this.adManagersActive+" (adManagerError)");var r=this.getBestAdManager();r&&this.emit(AdManagerPreloader.BEST_ADMANAGER_READY,r),this.checkAllComplete(),this.loadAdManager()},AdManagerPreloader.prototype.checkAllComplete=function(){this.isAllAdManagersComplete()&&(Debug.logInfo("All ad managers ready"),this.emit(AdManagerPreloader.ALL_ADMANAGERS_COMPLETE))},AdManagerPreloader.prototype.isAllAdManagersComplete=function(){if(this.adProvider.isAllRequestsComplete()&&0===this.adResponsesQueue.length){for(var e=0;e<this.adManagersQueue.length;e++){if(this.adManagersQueue[e].status===AdManagerFirstPhase.STATUS_LOADING)return!1}return!0}return!1},AdManagerPreloader.prototype.cleanupEverything=function(){this.cleanUpCalled=!0,this.adProvider.off(AdProvider.BEST_AD_READY,this.onBestAdReady),this.adProvider.off(AdProvider.ALL_REQUESTS_COMPLETE,this.onAllRequestsComplete);for(var e=0;e<this.adManagersQueue.length;e++){var a=this.adManagersQueue[e];a.off(AdManagerFirstPhase.EVENT_READY,this.adManagerReady),a.off(AdManagerFirstPhase.EVENT_ERROR,this.adManagerError),a.cleanupEverything()}};
},{"../app/AdManagerFirstPhase":2,"../app/Config":5,"../dev/Debug":7,"../events/SmokeSignals":8,"../requests/AdProvider":9,"../requests/AdRequestFlash":11}],5:[function(require,module,exports){
"use strict";function parseInt2(e,o){var n=parseInt(e);return isNaN(n)?o:n}function parseFloat2(e,o){var n=parseFloat(e);return isNaN(n)?o:n}var Config=function(){this.init.apply(this,arguments)};exports.Config=Config;var Debug=require("../dev/Debug").Debug;Config.TAGS_URL="",Config.DEBUG=!1,Config.DEBUG_LEVEL=0,Config.TIMEOUT_TAGS=10,Config.TIMEOUT_INTERMEDIATE_TAGS=0,Config.TIMEOUT_ADSOURCE=10,Config.WRAPPER_LIMIT=3,Config.TIMEOUT_SWF_LOADER=10,Config.TIMEOUT_VPAID_INIT=15,Config.TIMEOUT_VPAID_IMPRESSION=15,Config.TIMEOUT_VAST_TRACKING=5,Config.NUMBER_ADS=1,Config.CURRENT_AD=0,Config.VOLUME=-1,Config.VOLUME_FORCE=-1,Config.USE_LEGACY_LOGIC=!1,Config.PARALLEL_ADMANAGERS=1,Config.CSS="",Config.FLASH="",Config.LOG_XML_CONTENT=!1,Config.PREFER_JS=!1,Config.SECURE_URL=!1,Config.FORCE_BUCKET_ORDER=!1,Config.LIMIT_AD_DURATION=!0,Config.TRACKING_CALLBACK="",Config.SHOW_CID=!1,Config.MUTED=!1,Config.prototype.init=function(){},Config.init=function(e){var o,n;for(o in e)if(e.hasOwnProperty(o))switch(n=String(e[o]),o){case"tags_url":Config.TAGS_URL=n;break;case"debug":Config.DEBUG="true"===n.toLowerCase();break;case"debug_level":Config.DEBUG_LEVEL=parseInt2(n,Config.DEBUG_LEVEL);break;case"timeout_tags":Config.TIMEOUT_TAGS=parseInt2(n,Config.TIMEOUT_TAGS);break;case"timeout_adsource":Config.TIMEOUT_ADSOURCE=parseInt2(n,Config.TIMEOUT_ADSOURCE);break;case"wrapper_limit":Config.WRAPPER_LIMIT=parseInt2(n,Config.WRAPPER_LIMIT);break;case"timeout_swf_loader":Config.TIMEOUT_SWF_LOADER=parseInt2(n,Config.TIMEOUT_SWF_LOADER);break;case"timeout_vpaid_init":Config.TIMEOUT_VPAID_INIT=parseInt2(n,Config.TIMEOUT_VPAID_INIT);break;case"timeout_vpaid_impression":Config.TIMEOUT_VPAID_IMPRESSION=parseInt2(n,Config.TIMEOUT_VPAID_IMPRESSION);break;case"timeout_vast_tracking":Config.TIMEOUT_VAST_TRACKING=parseInt2(n,Config.TIMEOUT_VAST_TRACKING);break;case"number_ads":Config.NUMBER_ADS=parseInt2(n,Config.NUMBER_ADS);break;case"current_ad":Config.CURRENT_AD=parseInt2(n,Config.CURRENT_AD);break;case"volume":Config.VOLUME=parseFloat2(n,Config.VOLUME);break;case"volume_force":Config.VOLUME_FORCE=parseFloat2(n,Config.VOLUME_FORCE);break;case"use_legacy_logic":Config.USE_LEGACY_LOGIC="true"===n.toLowerCase();break;case"parallel_admanagers":Config.PARALLEL_ADMANAGERS=parseInt2(n,Config.PARALLEL_ADMANAGERS);break;case"css":Config.CSS=n;break;case"flash":-1===n.indexOf("undefined")&&(Config.FLASH=n);break;case"log_xml_content":Config.LOG_XML_CONTENT="true"===n.toLowerCase();break;case"prefer_js":Config.PREFER_JS="true"===n.toLowerCase();break;case"secure_url":Config.SECURE_URL="true"===n.toLowerCase();break;case"force_bucket_order":Config.FORCE_BUCKET_ORDER="true"===n.toLowerCase();break;case"limit_ad_duration":Config.LIMIT_AD_DURATION="true"===n.toLowerCase();break;case"tracking_callback":Config.TRACKING_CALLBACK=n;break;case"show_cid":Config.SHOW_CID="true"===n.toLowerCase();break;case"muted":Config.MUTED="true"===n.toLowerCase()}},Config.apply=function(){Config.DEBUG&&Debug.enable(Config.DEBUG_LEVEL),-1!==Config.VOLUME_FORCE&&(-1===Config.VOLUME||Config.VOLUME>Config.VOLUME_FORCE)&&(Config.VOLUME=Config.VOLUME_FORCE)};
},{"../dev/Debug":7}],6:[function(require,module,exports){
"use strict";function Main(){this.init.apply(this,arguments)}exports.Main=Main;var AdManagerPreloader=require("../app/AdManagerPreloader").AdManagerPreloader,Config=require("../app/Config").Config,Debug=require("../dev/Debug").Debug,SmokeSignals=require("../events/SmokeSignals").SmokeSignals,ServerRequest=require("../requests/ServerRequest").ServerRequest,TagsRequest=require("../requests/TagsRequest").TagsRequest,Timer=require("../util/Timer").Timer,Util=require("../util/Util").Util,VolumeControl=require("../util/VolumeControl").VolumeControl,AdProvider=require("../requests/AdProvider").AdProvider,VPAIDEvent=require("../vpaid/VPAIDEvent").VPAIDEvent;Main.PAUSED_NOWHERE=0,Main.PAUSED_ADPROVIDERCALL=1,Main.PAUSED_PLAYNEXTAD=2,Main.PAUSED_ALLVASTADSCOMPLETED=3,Main.prototype.parameters,Main.prototype.muted,Main.prototype.isClientMode,Main.prototype.isPageVisible,Main.prototype.waterfallPausedLocation,Main.prototype.tagsRequest,Main.prototype.adProvider,Main.prototype.adManagerLoader,Main.prototype.adManager,Main.prototype.loadedAdResponse,Main.prototype.loadedCreative,Main.prototype.adResponsesPlayed,Main.prototype.adIsPlaying,Main.prototype.timer,Main.prototype.width,Main.prototype.height,Main.prototype.viewMode,Main.prototype.desiredBitrate,Main.prototype.adImpressionFired,Main.prototype.externalVolume,Main.prototype.adStoppedExternal,Main.prototype.volumeControl,Main.prototype.adDurationTimer,Main.prototype.adDurationTimerElapsed,Main.prototype.trackVolumeTimer,Main.prototype.startTime,Main.prototype.startTimeLastMessage,Main.prototype.lastMessage,Main.prototype.forceVolumeException,Main.prototype.noAdsCreatives,Main.prototype.currentAdIndex,Main.prototype.viewableImpressionTimer,Main.prototype.viewableImpressionPending,Main.prototype.adManagerPreloader,Main.prototype.stage,Main.prototype.adManagerFirstPhase,Main.prototype.environmentVars,Main.prototype.iframe,Main.prototype.isInfoBoxVisible,Main.prototype.errorFired,Main.prototype.init=function(e){SmokeSignals.convert(this),this.parameters=e||{},this.muted=0,this.isClientMode=!0,this.isPageVisible=!0,this.waterfallPausedLocation=Main.PAUSED_NOWHERE,this.tagsRequest=null,this.adProvider=null,this.adManagerLoader=null,this.adManager=null,this.loadedAdResponse=null,this.loadedCreative=null,this.adResponsesPlayed=0,this.adIsPlaying=!1,this.timer=null,this.width=0,this.height=0,this.viewMode="",this.desiredBitrate=0,this.adImpressionFired=!1,this.externalVolume=-1,this.adStoppedExternal=!1,this.volumeControl=null,this.adDurationTimer=null,this.adDurationTimerElapsed=0,this.trackVolumeTimer=null,this.startTime=0,this.startTimeLastMessage=0,this.lastMessage="",this.forceVolumeException=!1,this.noAdsCreatives=[],this.currentAdIndex=-1,this.viewableImpressionTimer=null,this.viewableImpressionPending=!1,this.adManagerPreloader=new AdManagerPreloader(this),this.stage=null,this.adManagerFirstPhase=null,this.environmentVars=null,this.iframe=null,this.isInfoBoxVisible=!1,this.errorFired=!1,this.parameters.hasOwnProperty("tags")&&this.startAsClient(this.parameters.tags)};var oldOnError=window.onerror;window.onerror=function(e,t,i,s,a){oldOnError&&oldOnError.apply(this,arguments),Debug.logWarn("UNCAUGHT_ERROR: "+e+"\nScript:\n"+t+" Line:\n"+i+" Column:\n"+s+" StackTrace:\n"+a)},Main.prototype.log3rdPartyException=function(e,t,i){t=t||"";var s=i&&i.name?i.name:"",a=i&&i.message?i.message:"",n=i&&i.stack?i.stack:"";Util.triggerOurTracking(e,this.isClientMode,"3RD_PARTY_CALL_EXCEPTION","",this.getElapsedTime(),0,[t,s,a,n]),Debug.logWarn("3RD_PARTY_CALL_EXCEPTION: "+t+", "+s+", "+a+", "+n,i)},Main.prototype.prepareStage=function(e){var t=e.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=Config.CSS,e.head.appendChild(t),this.stage.stage=e.createElement("div"),this.stage.stage.classList.add("stage"),this.stage.appendChild(this.stage.stage),this.stage.volumeControl=e.createElement("div"),this.stage.volumeControl.classList.add("volumeControl"),this.stage.volumeControl.classList.add("normal"),Util.videoSupportsVolume()||this.stage.volumeControl.classList.add("hidden"),this.stage.stage.appendChild(this.stage.volumeControl),this.stage.loader=e.createElement("div"),this.stage.loader.classList.add("loader"),this.stage.stage.appendChild(this.stage.loader);var i=e.createElement("div");i.classList.add("spinner"),this.stage.loader.appendChild(i),this.stage.slotsContainer=e.createElement("div"),this.stage.slotsContainer.classList.add("slotsContainer"),this.stage.stage.appendChild(this.stage.slotsContainer)},Main.prototype.startAsClient=function(e){Config.init(this.parameters),Config.apply(),this.stage=document.getElementById(this.parameters.stage),this.prepareStage(document);var t=this.getStageWidth(),i=this.getStageHeight();this.initAdClient(t||400,i||300,"",0);for(var s="FROM_JS"===e?getVastTagsNewAdManager():JSON.parse(e),a=0;a<s.length;a++)s[a].rand=Math.floor(9e6*Math.random())+1e6;Debug.logInfo("Start in client mode, tagsCount="+s.length),this.adProvider=new AdProvider(s,this),this.timer=new Timer(1e3,1),this.timer.on(Timer.TIMER_COMPLETE,this.visibilityCheckCallbackTimeout,this),this.timer.start(),isPageVisible(this)},Main.prototype.visibilityCheckCallback=function(e){if(this.timer.stop(),this.timer.off(Timer.TIMER_COMPLETE,this.visibilityCheckCallbackTimeout),!e&&this.isClientMode)return this.waterfallPausedLocation=Main.PAUSED_ADPROVIDERCALL,void Debug.logWarn("Playback paused at initialization (before adProvider.open). Waiting for focus to continue...");this.startAsClientContinue()},Main.prototype.visibilityCheckCallbackTimeout=function(){Debug.logWarn("Timeout while waiting for visibilityCheckCallback. Continue playback."),this.startAsClientContinue()},Main.prototype.startAsClientContinue=function(){this.adProvider.open(),this.adManagerPreloader.init2(this.adProvider),this.playNextAd()},Main.prototype.getAdLinear=function(){return!this.adIsPlaying||this.adManager.getAdLinear()},Main.prototype.getAdWidth=function(){return this.adIsPlaying?this.adManager.getAdWidth():this.width},Main.prototype.getAdHeight=function(){return this.adIsPlaying?this.adManager.getAdHeight():this.height},Main.prototype.getAdExpanded=function(){return!!this.adIsPlaying&&this.adManager.getAdExpanded()},Main.prototype.getAdSkippableState=function(){return!!this.adIsPlaying&&this.adManager.getAdSkippableState()},Main.prototype.getAdRemainingTime=function(){return this.adIsPlaying?this.adManager.getAdRemainingTime():0},Main.prototype.getAdDuration=function(){return this.adIsPlaying?this.adManager.getAdDuration():0},Main.prototype.getAdVolume=function(){return this.isClientMode?Util.getForceVolume():this.adIsPlaying?this.adManager.getAdVolume():this.externalVolume},Main.prototype.setAdVolumeCustom=function(e,t){if(this.isPageVisible=t,this.isPageVisible&&!this.isInfoBoxVisible){switch(this.waterfallPausedLocation){case Main.PAUSED_ADPROVIDERCALL:this.startAsClientContinue();break;case Main.PAUSED_PLAYNEXTAD:this.playNextAd();break;case Main.PAUSED_ALLVASTADSCOMPLETED:this.allVastAdsCompleted()}this.viewableImpressionPending&&(this.viewableImpressionTimer=new Timer(2e3,1),this.viewableImpressionTimer.on(Timer.TIMER_COMPLETE,this.viewableImpressionTimeout,this),this.viewableImpressionTimer.start())}else this.viewableImpressionTimer&&(this.viewableImpressionTimer.stop(),this.viewableImpressionTimer.off(Timer.TIMER_COMPLETE,this.viewableImpressionTimeout));this.waterfallPausedLocation=Main.PAUSED_NOWHERE,this.muted||null===e||(e/=100,isNaN(e)||this.setAdVolume(e))},Main.prototype.setAdVolume=function(e){this.isClientMode&&Util.setForceVolume(e),this.adIsPlaying&&this.adManager.setAdVolume(e),0===e?this.volumeControl.setStateMuted():this.volumeControl.setStateUnmuted(),this.externalVolume=e},Main.prototype.getAdCompanions=function(){return this.adIsPlaying?this.adManager.getAdCompanions():""},Main.prototype.getAdIcons=function(){return!this.adIsPlaying||this.adManager.getAdIcons()},Main.prototype.handshakeVersion=function(e){return"1.0"},Main.prototype.getStageWidth=function(){return this.stage.clientWidth},Main.prototype.getStageHeight=function(){return this.stage.clientHeight},Main.prototype.initAd=function(e,t,i,s,a,n){if(this.isClientMode=!1,this.resizeAd(e,t,i),this.desiredBitrate=s,this.creativeData=a,this.creativeData.AdParameters&&(this.creativeData=this.creativeData.AdParameters),"string"==typeof this.creativeData&&(this.creativeData=JSON.parse(this.creativeData)),this.environmentVars=n,Config.init(this.creativeData,!1),Config.PARALLEL_ADMANAGERS=1,Config.apply(),!this.environmentVars||!this.environmentVars.slot||!this.environmentVars.videoSlot)return Debug.logError("environmentVars parameter is invalid"),void this.emit(VPAIDEvent.AdError);this.iframe=document.createElement("iframe"),this.iframe.setAttribute("frameborder","0"),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("marginwidth","0"),this.iframe.setAttribute("marginheight","0"),this.iframe.setAttribute("allowtransparency","true"),this.iframe.setAttribute("style","border:none;width:100%;height:100%;margin:0;padding:0;position:absolute;top:0;left:0;");var r=this;this.iframe.onload=function(){var e=r.iframe.contentWindow.document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=Config.CSS,r.iframe.contentWindow.document.head.appendChild(e),r.stage=r.iframe.contentWindow.document.body,r.prepareStage(r.iframe.contentWindow.document),r.afterInit(),r.emit(VPAIDEvent.AdLoaded)},this.environmentVars.slot.appendChild(this.iframe)},Main.prototype.initAdClient=function(e,t,i,s){this.isClientMode=!0,this.resizeAd(e,t,i),this.desiredBitrate=s,this.afterInit(),this.adResponsesPlayed=Config.CURRENT_AD,this.emit(VPAIDEvent.AdLoaded)},Main.prototype.close=function(e){void 0===e&&(e=!0),this.stopAd(),e&&clearContent()},Main.prototype.setTrackingPixel=function(e,t,i,s){if(void 0===s&&(s=""),e){var a={};a.p=t,e+=-1===e.indexOf("?")?"?old=1":"&old=1",setPixel(e+(-1===e.indexOf("?")?"?":"&")+Util.urlEncodeParams(a)+"&v="+i+"&t=0&shown="+this.adResponsesPlayed+s,("4"===i||"5"===i||"1"===i||"14"===i)&&"TRACK")}},Main.prototype.afterInit=function(){try{Util.startForceVolume(Config.VOLUME_FORCE)}catch(e){this.forceVolumeException=!0}this.volumeControl=new VolumeControl(this.stage.volumeControl,0===Config.VOLUME_FORCE||Config.MUTED),this.volumeControl.on(VolumeControl.UNMUTE,this.volumeUnmute,this),this.volumeControl.on(VolumeControl.MUTE,this.volumeMute,this),0===Config.VOLUME_FORCE&&0===this.muted&&this.volumeMute()},Main.prototype.volumeUnmute=function(){this.adIsPlaying&&(this.adManager.getAdVolume()===this.adManager.prevAdVolume?this.adManager.setAdVolume(1,!0):this.adManager.setAdVolume(this.adManager.prevAdVolume,!0)),Util.forceVolumeUnmute(),this.muted=!1},Main.prototype.volumeMute=function(){this.adIsPlaying&&this.adManager.setAdVolume(0,!0),Util.forceVolumeMute(),this.muted=!0},Main.prototype.resizeAd=function(e,t,i){this.width=e,this.height=t,this.viewMode=i,this.adIsPlaying&&this.adManager.resizeAd(e,t,i),this.emit(VPAIDEvent.AdSizeChange)},Main.prototype.startAd=function(){this.tagsRequest=new TagsRequest,this.tagsRequest.on(ServerRequest.COMPLETE,this.tagsRequestComplete,this),this.tagsRequest.open()},Main.prototype.tagsRequestComplete=function(){this.tagsRequest.status===ServerRequest.STATUS_COMPLETE?this.tagsRequest.resultTags.length>0?(Debug.logInfo("Got "+this.tagsRequest.resultTags.length+" tags from server"),this.adProvider=new AdProvider(this.tagsRequest.resultTags,this),this.adProvider.open(),this.adManagerPreloader.init2(this.adProvider),this.playNextAd()):(Debug.logError("Got empty response from server"),this.emit(VPAIDEvent.AdError)):(Debug.logError("Can't fetch tags from server"),this.emit(VPAIDEvent.AdError))},Main.prototype.playNextAd=function(e){if(!this.adIsPlaying){if(Config.MUTED&&this.volumeControl.setStateMuted(!0),void 0===e&&(e=null),this.stage.loader.classList.remove("hidden"),this.adManagerPreloader.off(AdManagerPreloader.BEST_ADMANAGER_READY,this.onBestAdManagerReady),this.adManagerPreloader.off(AdManagerPreloader.ALL_ADMANAGERS_COMPLETE,this.onAllAdManagersComplete),!this.adImpressionFired&&this.loadedAdResponse&&this.addNoAdCreative(this.loadedAdResponse.tag.cid),Config.NUMBER_ADS>0&&this.adResponsesPlayed===Config.NUMBER_ADS)return Debug.logInfo("Finished playing "+this.adResponsesPlayed+" ads"),this.cleanupEverything(),void this.emit(VPAIDEvent.AdStopped);if(this.adStoppedExternal)return Debug.logWarn("StopAd called from external ad manager. Aborting."),this.cleanupEverything(),void this.emit(VPAIDEvent.AdStopped);null!==e&&this.adManagerPreloader.adManagerFinished(e);var t=this.adManagerPreloader.getBestAdManager();if(null===t)if(this.adManagerPreloader.isAllAdManagersComplete())0===this.adResponsesPlayed?(Debug.logError("No ads"),this.cleanupEverything(),this.emit(VPAIDEvent.AdError)):(Debug.logInfo("Finished playing "+this.adResponsesPlayed+" ads (max. "+Config.NUMBER_ADS+")"),this.cleanupEverything(),this.emit(VPAIDEvent.AdStopped));else{if(this.adImpressionFired&&!this.isInfoBoxVisible&&hideBanner(),(!this.isPageVisible||this.isInfoBoxVisible)&&this.isClientMode)return this.waterfallPausedLocation=Main.PAUSED_PLAYNEXTAD,void Debug.logWarn("Playback paused at playNextAd. Waiting for focus to continue...");this.adManagerPreloader.on(AdManagerPreloader.BEST_ADMANAGER_READY,this.onBestAdManagerReady,this),this.adManagerPreloader.on(AdManagerPreloader.ALL_ADMANAGERS_COMPLETE,this.onAllAdManagersComplete,this)}else{if(this.adImpressionFired&&!this.isInfoBoxVisible&&hideBanner(),(!this.isPageVisible||this.isInfoBoxVisible)&&this.isClientMode)return this.waterfallPausedLocation=Main.PAUSED_PLAYNEXTAD,void Debug.logWarn("Playback paused at playNextAd. Waiting for focus to continue...");this.playAd(t)}}},Main.prototype.addNoAdCreative=function(e){this.noAdsCreatives.push(e)},Main.prototype.cleanupEverything=function(){if(Debug.logInfo("Executing cleanup"),this.adManagerPreloader.cleanupEverything(),this.isClientMode)for(;this.stage.firstChild;)this.stage.removeChild(this.stage.firstChild);else try{this.environmentVars.slot.removeChild(this.iframe)}catch(e){}if(Util.stopForceVolume(this),this.isClientMode){if(!this.isPageVisible)return this.waterfallPausedLocation=Main.PAUSED_ALLVASTADSCOMPLETED,void Debug.logWarn("Playback paused at allVastAdsCompleted. Waiting for focus to continue...");this.allVastAdsCompleted()}},Main.prototype.allVastAdsCompleted=function(){allVastAdsCompleted(this.adResponsesPlayed,0,this.noAdsCreatives.join(","))},Main.prototype.playAd=function(e){if(!this.adStoppedExternal){this.adManagerFirstPhase=e,this.loadedAdResponse=e.adResponse,this.loadedCreative=e.creative,this.mediaFile=e.mediaFile,this.adManager=e.adManager,this.adManagerLoader=e.adManagerLoader,e.finishFirstPhase(),Debug.logInfo("("+this.loadedAdResponse.serverOrder+") Trying to play ad"),this.loadedAdResponse.playOrder=++this.currentAdIndex,this.adImpressionFired=!1,this.errorFired=!1,this.adIsPlaying=!0,this.adDurationTimer=null,this.trackVolumeTimer=new Timer(1e3,0),this.trackVolumeTimer.on(Timer.TIMER,this.onTrackVolumeTimeout,this),this.trackVolumeTimer.start();var t=(new Date).getTime();this.startTime=t-(e.endTime-e.startTime),this.startTimeLastMessage=t-(e.endTime-e.startTimeLastMessage),this.lastMessage=e.lastMessage,this.addVPAIDEventListeners(),this.timer=new Timer(1e3*Config.TIMEOUT_VPAID_IMPRESSION,1),this.timer.delay>0&&(this.timer.on(Timer.TIMER_COMPLETE,this.onImpressionTimeout,this),this.timer.start()),this.setVolume(),this.adManager.prevAdVolume=this.getAdVolume(),Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"STARTAD",this.getLastMessage("STARTAD"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.adManager.startAd()}},Main.prototype.onBestAdManagerReady=function(e,t){this.adManagerPreloader.off(AdManagerPreloader.BEST_ADMANAGER_READY,this.onBestAdManagerReady),this.adManagerPreloader.off(AdManagerPreloader.ALL_ADMANAGERS_COMPLETE,this.onAllAdManagersComplete),this.adStoppedExternal||this.playAd(t)},Main.prototype.getElapsedTime=function(){return Math.floor(((new Date).getTime()-this.startTime)/1e3)},Main.prototype.getElapsedTimeLastMessage=function(){var e=(new Date).getTime(),t=Math.floor((e-this.startTimeLastMessage)/1e3);return this.startTimeLastMessage=e,t},Main.prototype.getLastMessage=function(e){var t=this.lastMessage;return this.lastMessage=e,t},Main.prototype.onTrackVolumeTimeout=function(){this.adManagerFirstPhase&&this.adManagerFirstPhase.volumeForceInfo&&(this.adManagerFirstPhase.volumeForceInfo.forceVolumeChanges>10||this.adManagerFirstPhase.volumeForceInfo.forceVolumeErrors>2)&&(Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"FORCE_VOLUME_TRACKING","",this.getElapsedTime(),0,[this.adManagerFirstPhase.volumeForceInfo.forceVolumeChanges,this.adManagerFirstPhase.volumeForceInfo.forceVolumeErrors]),this.trackVolumeTimer.stop(),this.trackVolumeTimer.off(Timer.TIMER,this.onTrackVolumeTimeout))},Main.prototype.onAllAdManagersComplete=function(){this.adManagerPreloader.off(AdManagerPreloader.BEST_ADMANAGER_READY,this.onBestAdManagerReady),this.adManagerPreloader.off(AdManagerPreloader.ALL_ADMANAGERS_COMPLETE,this.onAllAdManagersComplete),this.playNextAd()},Main.prototype.stopAd=function(){this.adStoppedExternal=!0,this.adIsPlaying&&this.adManager.stopAd()},Main.prototype.pauseAd=function(){this.adIsPlaying&&this.adManager.pauseAd()},Main.prototype.resumeAd=function(){this.adIsPlaying&&this.adManager.resumeAd()},Main.prototype.expandAd=function(){this.adIsPlaying&&this.adManager.expandAd()},Main.prototype.collapseAd=function(){this.adIsPlaying&&this.adManager.collapseAd()},Main.prototype.skipAd=function(){this.adIsPlaying&&this.adManager.skipAd()},Main.prototype.subscribe=function(e,t,i){this.on(t,e,i)},Main.prototype.unsubscribe=function(e,t){this.off(t,e)},Main.prototype.addVPAIDEventListeners=function(){this.adManager.subscribe(this.adStarted,VPAIDEvent.AdStarted,this),this.adManager.subscribe(this.adStopped,VPAIDEvent.AdStopped,this),this.adManager.subscribe(this.adSkipped,VPAIDEvent.AdSkipped,this),this.adManager.subscribe(this.adLinearChange,VPAIDEvent.AdLinearChange,this),this.adManager.subscribe(this.adSizeChange,VPAIDEvent.AdSizeChange,this),this.adManager.subscribe(this.adExpandedChange,VPAIDEvent.AdExpandedChange,this),this.adManager.subscribe(this.adSkippableStateChange,VPAIDEvent.AdSkippableStateChange,this),this.adManager.subscribe(this.adRemainingTimeChange,VPAIDEvent.AdRemainingTimeChange,this),this.adManager.subscribe(this.adDurationChange,VPAIDEvent.AdDurationChange,this),this.adManager.subscribe(this.adVolumeChange,VPAIDEvent.AdVolumeChange,this),this.adManager.subscribe(this.adImpression,VPAIDEvent.AdImpression,this),this.adManager.subscribe(this.adVideoStart,VPAIDEvent.AdVideoStart,this),this.adManager.subscribe(this.adVideoFirstQuartile,VPAIDEvent.AdVideoFirstQuartile,this),this.adManager.subscribe(this.adVideoMidpoint,VPAIDEvent.AdVideoMidpoint,this),this.adManager.subscribe(this.adVideoThirdQuartile,VPAIDEvent.AdVideoThirdQuartile,this),this.adManager.subscribe(this.adVideoComplete,VPAIDEvent.AdVideoComplete,this),this.adManager.subscribe(this.adClickThru,VPAIDEvent.AdClickThru,this),this.adManager.subscribe(this.adInteraction,VPAIDEvent.AdInteraction,this),this.adManager.subscribe(this.adUserAcceptInvitation,VPAIDEvent.AdUserAcceptInvitation,this),this.adManager.subscribe(this.adUserMinimize,VPAIDEvent.AdUserMinimize,this),this.adManager.subscribe(this.adUserClose,VPAIDEvent.AdUserClose,this),this.adManager.subscribe(this.adPaused,VPAIDEvent.AdPaused,this),this.adManager.subscribe(this.adPlaying,VPAIDEvent.AdPlaying,this),this.adManager.subscribe(this.adLog,VPAIDEvent.AdLog,this),this.adManager.subscribe(this.adError,VPAIDEvent.AdError,this)},Main.prototype.removeVPAIDEventListeners=function(){this.adManager.unsubscribe(this.adStarted,VPAIDEvent.AdStarted),this.adManager.unsubscribe(this.adStopped,VPAIDEvent.AdStopped),this.adManager.unsubscribe(this.adSkipped,VPAIDEvent.AdSkipped),this.adManager.unsubscribe(this.adLinearChange,VPAIDEvent.AdLinearChange),this.adManager.unsubscribe(this.adSizeChange,VPAIDEvent.AdSizeChange),this.adManager.unsubscribe(this.adExpandedChange,VPAIDEvent.AdExpandedChange),this.adManager.unsubscribe(this.adSkippableStateChange,VPAIDEvent.AdSkippableStateChange),this.adManager.unsubscribe(this.adRemainingTimeChange,VPAIDEvent.AdRemainingTimeChange),this.adManager.unsubscribe(this.adDurationChange,VPAIDEvent.AdDurationChange),this.adManager.unsubscribe(this.adVolumeChange,VPAIDEvent.AdVolumeChange),this.adManager.unsubscribe(this.adImpression,VPAIDEvent.AdImpression),this.adManager.unsubscribe(this.adVideoStart,VPAIDEvent.AdVideoStart),this.adManager.unsubscribe(this.adVideoFirstQuartile,VPAIDEvent.AdVideoFirstQuartile),this.adManager.unsubscribe(this.adVideoMidpoint,VPAIDEvent.AdVideoMidpoint),this.adManager.unsubscribe(this.adVideoThirdQuartile,VPAIDEvent.AdVideoThirdQuartile),this.adManager.unsubscribe(this.adVideoComplete,VPAIDEvent.AdVideoComplete),this.adManager.unsubscribe(this.adClickThru,VPAIDEvent.AdClickThru),this.adManager.unsubscribe(this.adInteraction,VPAIDEvent.AdInteraction),this.adManager.unsubscribe(this.adUserAcceptInvitation,VPAIDEvent.AdUserAcceptInvitation),this.adManager.unsubscribe(this.adUserMinimize,VPAIDEvent.AdUserMinimize),this.adManager.unsubscribe(this.adUserClose,VPAIDEvent.AdUserClose),this.adManager.unsubscribe(this.adPaused,VPAIDEvent.AdPaused),this.adManager.unsubscribe(this.adPlaying,VPAIDEvent.AdPlaying),this.adManager.unsubscribe(this.adLog,VPAIDEvent.AdLog),this.adManager.unsubscribe(this.adError,VPAIDEvent.AdError)},Main.prototype.logAndDispatch=function(e,t){void 0===t&&(t=!0),e&&(Debug.logTrace("("+this.loadedAdResponse.serverOrder+") "+e),t&&this.emit(e))},Main.prototype.setVolume=function(){if(-1!==Config.VOLUME){var e=this.getAdVolume();this.setAdVolume(e+(e>.5?-.1:.1)),this.setAdVolume(this.muted?0:0!==Config.VOLUME?Config.VOLUME:1),e!==this.getAdVolume()&&Debug.logWarn("Set volume to "+Config.VOLUME+" from "+e+" (applied: "+this.getAdVolume()+")")}else-1!==this.externalVolume&&this.setAdVolume(this.externalVolume)},Main.prototype.adStarted=function(e){this.logAndDispatch(e.type,!1),Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"creativeView"),this.setVolume(),Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"ADSTARTED",this.getLastMessage("ADSTARTED"),this.getElapsedTime(),this.getElapsedTimeLastMessage())},Main.prototype.adStopped=function(e){this.logAndDispatch(e.type,!1),this.timer.stop(),this.timer.off(Timer.TIMER_COMPLETE,this.onImpressionTimeout),null!==this.adDurationTimer&&(this.adDurationTimer.stop(),this.adDurationTimer.off(Timer.TIMER_COMPLETE,this.onAdDurationTimeout)),null!==this.trackVolumeTimer&&(this.trackVolumeTimer.stop(),this.trackVolumeTimer.off(Timer.TIMER,this.onTrackVolumeTimeout)),this.viewableImpressionTimer&&(this.viewableImpressionTimer.stop(),this.viewableImpressionTimer.off(Timer.TIMER_COMPLETE,this.viewableImpressionTimeout)),this.viewableImpressionPending=!1,this.removeVPAIDEventListeners(),this.adManagerFirstPhase.cleanupEverything(),Debug.logInfo("("+this.loadedAdResponse.serverOrder+") Ad manager removed from stage"),this.adIsPlaying=!1,this.loadedAdResponse.alreadyPlayed=!0,this.adImpressionFired||this.errorFired||(Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"ADMANAGER_NO_ADS_AFTER_STARTAD",this.getLastMessage("ADMANAGER_NO_ADS_AFTER_STARTAD"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),Config.USE_LEGACY_LOGIC&&(this.errorFired=!0,this.setTrackingPixel(this.loadedAdResponse.tag.tracking,this.loadedAdResponse.tag.trackingp,"5"))),this.playNextAd(this.loadedAdResponse)},Main.prototype.adSkipped=function(e){this.logAndDispatch(e.type),Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"ADSKIPPED","",this.getElapsedTime(),0)},Main.prototype.adLinearChange=function(e){this.logAndDispatch(e.type)},Main.prototype.adSizeChange=function(e){this.logAndDispatch(e.type)},Main.prototype.adExpandedChange=function(e){this.logAndDispatch(e.type)},Main.prototype.adSkippableStateChange=function(e){this.logAndDispatch(e.type)},Main.prototype.fireProgressTracking=function(){if(this.adManager.getAdRemainingTime()>=0){var e=this.adManager.getAdDuration();e<=0&&(e=this.adManager.estimatedDuration)<=0&&(this.adManager.estimatedDuration=this.adManager.getAdRemainingTime(),e=this.adManager.estimatedDuration);var t=e-this.adManager.getAdRemainingTime(),i=Math.floor(t/e*100);Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"progress",1e3*t,i)}},Main.prototype.adRemainingTimeChange=function(e){this.logAndDispatch(e.type),this.fireProgressTracking()},Main.prototype.adDurationChange=function(e){this.logAndDispatch(e.type),this.fireProgressTracking()},Main.prototype.adVolumeChange=function(e){this.logAndDispatch(e.type),0===this.adManager.getAdVolume()&&this.adManager.prevAdVolume>0&&Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"mute"),this.adManager.getAdVolume()>0&&0===this.adManager.prevAdVolume&&Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"unmute")},Main.prototype.onImpressionTimeout=function(){Debug.logWarn("("+this.loadedAdResponse.serverOrder+") Impression timeout"),Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"TO_IMPRESSION",this.getLastMessage("TO_IMPRESSION"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),Config.USE_LEGACY_LOGIC&&this.setTrackingPixel(this.loadedAdResponse.tag.tracking,this.loadedAdResponse.tag.trackingp,"1"),this.adManager.stopAd()},Main.prototype.hideLoaderForDirect=function(){this.timer.stop(),this.timer.off(Timer.TIMER_COMPLETE,this.onImpressionTimeout),this.stage.loader.classList.add("hidden"),this.adManagerFirstPhase.environmentVars.item.classList.remove("invisible")},Main.prototype.adImpression=function(e){this.adImpressionFired||(this.emit(VPAIDEvent.AdStarted),this.adImpressionFired=!0,this.logAndDispatch(e.type),Util.triggerImpressionTracking(this.loadedAdResponse),this.timer.stop(),this.timer.off(Timer.TIMER_COMPLETE,this.onImpressionTimeout),this.setVolume(),0===Config.VOLUME_FORCE&&0===this.muted&&this.volumeMute(),Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"IMPRESSION",this.getLastMessage("IMPRESSION"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.stage.loader.classList.add("hidden"),this.adManagerFirstPhase.environmentVars.item.classList.remove("invisible"),this.adResponsesPlayed++,this.isClientMode?setPixel(this.loadedAdResponse.tag.impression+"#"+this.loadedAdResponse.tag.rand,"DISPLAY"):Util.triggerTracking(this.loadedAdResponse.tag.impression),Config.USE_LEGACY_LOGIC&&this.setTrackingPixel(this.loadedAdResponse.tag.tracking,this.loadedAdResponse.tag.trackingp,"6"),this.adDurationTimerElapsed=30,this.adDurationTimer=new Timer(3e4,1),this.adDurationTimer.on(Timer.TIMER_COMPLETE,this.onAdDurationTimeout,this),Config.LIMIT_AD_DURATION&&!Config.DEBUG&&this.adDurationTimer.start(),this.viewableImpressionPending=!0,this.isPageVisible&&(this.viewableImpressionTimer=new Timer(2e3,1),this.viewableImpressionTimer.on(Timer.TIMER_COMPLETE,this.viewableImpressionTimeout,this),this.viewableImpressionTimer.start()))},Main.prototype.viewableImpressionTimeout=function(){this.viewableImpressionTimer.stop(),this.viewableImpressionTimer.off(Timer.TIMER_COMPLETE,this.viewableImpressionTimeout),this.viewableImpressionPending&&(Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"VIEWABLE_IMPRESSION",this.getLastMessage("VIEWABLE_IMPRESSION"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.viewableImpressionPending=!1)},Main.prototype.onAdDurationTimeout=function(){if(this.adDurationTimer.off(Timer.TIMER_COMPLETE,this.onAdDurationTimeout),this.adDurationTimer.stop(),Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"VIDEO_DURATION_"+this.adDurationTimerElapsed+"s","",this.getElapsedTime(),0),this.adDurationTimerElapsed>=40)return void this.adManager.stopAd();this.adDurationTimerElapsed+=10,this.adDurationTimerElapsed<120&&(this.adDurationTimer=new Timer(1e4,1),this.adDurationTimer.on(Timer.TIMER_COMPLETE,this.onAdDurationTimeout,this),this.adDurationTimer.start())},Main.prototype.adVideoStart=function(e){this.logAndDispatch(e.type),this.setVolume(),Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"start"),Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"progress",-1,0),Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"PROGRESS_0%",this.getLastMessage("PROGRESS_0%"),this.getElapsedTime(),this.getElapsedTimeLastMessage())},Main.prototype.adVideoFirstQuartile=function(e){this.logAndDispatch(e.type),this.adImpressionFired&&(Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"firstQuartile"),Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"progress",-1,25),Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"PROGRESS_25%",this.getLastMessage("PROGRESS_25%"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),Config.USE_LEGACY_LOGIC&&this.setTrackingPixel(this.loadedAdResponse.tag.tracking,this.loadedAdResponse.tag.trackingp,"7"))},Main.prototype.adVideoMidpoint=function(e){this.logAndDispatch(e.type),this.adImpressionFired&&(Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"midpoint"),Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"progress",-1,50),Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"PROGRESS_50%",this.getLastMessage("PROGRESS_50%"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),Config.USE_LEGACY_LOGIC&&this.setTrackingPixel(this.loadedAdResponse.tag.tracking,this.loadedAdResponse.tag.trackingp,"8"))},Main.prototype.adVideoThirdQuartile=function(e){this.logAndDispatch(e.type),this.adImpressionFired&&(Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"thirdQuartile"),Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"progress",-1,75),Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"PROGRESS_75%",this.getLastMessage("PROGRESS_75%"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),Config.USE_LEGACY_LOGIC&&this.setTrackingPixel(this.loadedAdResponse.tag.tracking,this.loadedAdResponse.tag.trackingp,"9"))},Main.prototype.adVideoComplete=function(e){this.logAndDispatch(e.type),this.adImpressionFired&&(Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"complete"),Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"progress",-1,100),Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"PROGRESS_100%",this.getLastMessage("PROGRESS_100%"),this.getElapsedTime(),this.getElapsedTimeLastMessage()),Config.USE_LEGACY_LOGIC&&this.setTrackingPixel(this.loadedAdResponse.tag.tracking,this.loadedAdResponse.tag.trackingp,"10"))},Main.prototype.adClickThru=function(e){this.logAndDispatch(e.type),Util.triggerCreativeClickTracking(this.loadedAdResponse,this.loadedCreative,e.type);var t=[];if(e.data&&t.push(e.data.url,e.data.id,e.data.playerHandles),Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"CLICK_THRU","",this.getElapsedTime(),this.getElapsedTimeLastMessage(),t),e.data&&e.data.playerHandles)try{window.open(e.data.url,"_blank")}catch(e){Debug.logWarn("("+this.loadedAdResponse.serverOrder+") Can't open clickThrough URL in new tab",e)}Config.USE_LEGACY_LOGIC&&this.setTrackingPixel(this.loadedAdResponse.tag.tracking,this.loadedAdResponse.tag.trackingp,"16")},Main.prototype.adInteraction=function(e){this.logAndDispatch(e.type)},Main.prototype.adUserAcceptInvitation=function(e){this.logAndDispatch(e.type),Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"acceptInvitationLinear")},
Main.prototype.adUserMinimize=function(e){this.logAndDispatch(e.type),Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"collapse")},Main.prototype.adUserClose=function(e){this.logAndDispatch(e.type),Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"closeLinear"),Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,"ADUSERCLOSE","",this.getElapsedTime(),0),this.adManager.stopAd(),this.adManager.emit(VPAIDEvent.AdStopped)},Main.prototype.adPaused=function(e){this.logAndDispatch(e.type),Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"pause")},Main.prototype.adPlaying=function(e){this.logAndDispatch(e.type),Util.triggerCreativeTracking(this.loadedAdResponse,this.loadedCreative,"resume")},Main.prototype.adLog=function(e){this.logAndDispatch(e.type)},Main.prototype.adError=function(e){if(this.logAndDispatch(e.type,!1),!this.errorFired){Util.triggerErrorTracking(this.loadedAdResponse,901);var t="ERROR_AFTER_"+(this.adImpressionFired?"IMPRESSION":"STARTAD");Util.triggerOurTracking(this.loadedAdResponse,this.isClientMode,t,this.getLastMessage(t),this.getElapsedTime(),this.getElapsedTimeLastMessage()),this.errorFired=!0,this.adImpressionFired&&Config.USE_LEGACY_LOGIC&&this.setTrackingPixel(this.loadedAdResponse.tag.tracking,this.loadedAdResponse.tag.trackingp,"4","&vec=901")}this.adManager.stopAd()},Main.prototype.setInfoBoxVisible=function(e){this.isInfoBoxVisible=e,e?(this.adManager.pauseAd(),this.adDurationTimer.stop(),this.viewableImpressionTimer&&(this.viewableImpressionTimer.stop(),this.viewableImpressionTimer.off(Timer.TIMER_COMPLETE,this.viewableImpressionTimeout))):(this.adManager.resumeAd(),Config.LIMIT_AD_DURATION&&!Config.DEBUG&&this.adDurationTimer.resume(),this.waterfallPausedLocation===Main.PAUSED_PLAYNEXTAD&&hideBanner(),this.setAdVolumeCustom(null,!0))},Main.prototype.getExternalInterface=function(){return{setVolume:Util.bind(this.setAdVolumeCustom,this),close:Util.bind(this.close,this),visibilityCheckCallback:Util.bind(this.visibilityCheckCallback,this),setInfoBoxVisible:Util.bind(this.setInfoBoxVisible,this)}},window.PMAdManager=Main,window.getVPAIDAd=function(){var e=new Main;return{getAdLinear:Util.bind(e.getAdLinear,e),getAdWidth:Util.bind(e.getAdWidth,e),getAdHeight:Util.bind(e.getAdHeight,e),getAdExpanded:Util.bind(e.getAdExpanded,e),getAdSkippableState:Util.bind(e.getAdSkippableState,e),getAdRemainingTime:Util.bind(e.getAdRemainingTime,e),getAdDuration:Util.bind(e.getAdDuration,e),getAdVolume:Util.bind(e.getAdVolume,e),setAdVolume:Util.bind(e.setAdVolume,e),getAdCompanions:Util.bind(e.getAdCompanions,e),getAdIcons:Util.bind(e.getAdIcons,e),handshakeVersion:Util.bind(e.handshakeVersion,e),initAd:Util.bind(e.initAd,e),resizeAd:Util.bind(e.resizeAd,e),startAd:Util.bind(e.startAd,e),stopAd:Util.bind(e.stopAd,e),pauseAd:Util.bind(e.pauseAd,e),resumeAd:Util.bind(e.resumeAd,e),expandAd:Util.bind(e.expandAd,e),collapseAd:Util.bind(e.collapseAd,e),skipAd:Util.bind(e.skipAd,e),subscribe:Util.bind(e.subscribe,e),unsubscribe:Util.bind(e.unsubscribe,e)}};
},{"../app/AdManagerPreloader":4,"../app/Config":5,"../dev/Debug":7,"../events/SmokeSignals":8,"../requests/AdProvider":9,"../requests/ServerRequest":13,"../requests/TagsRequest":14,"../util/Timer":15,"../util/Util":16,"../util/VolumeControl":17,"../vpaid/VPAIDEvent":18}],7:[function(require,module,exports){
"use strict";function formatTimeStamp(e){var o=e.getHours(),n=e.getMinutes(),r=e.getSeconds(),l=e.getMilliseconds();return(o<10?"0":"")+o+":"+(n<10?"0":"")+n+":"+(r<10?"0":"")+r+"."+(l<10?"00":l<100?"0":"")+l}var Debug=function(){this.init.apply(this,arguments)};exports.Debug=Debug,Debug.enabled=!1,Debug.level=0,Debug.rand,Debug.console,Debug.prototype.init=function(){},Debug.enable=function(e){Debug.enabled=!0,Debug.level=e,Debug.rand=Math.floor(9e4*Math.random())+1e4,Debug.console=window.console,Debug.consoleLog=window.console&&"function"==typeof window.console.log?window.console.log:function(){},Debug.consoleWarn=window.console&&"function"==typeof window.console.warn?window.console.warn:function(){},Debug.consoleError=window.console&&"function"==typeof window.console.error?window.console.error:function(){}},Debug.logTrace=function(){try{Debug.enabled&&Debug.level<=0&&(Array.prototype.splice.apply(arguments,[0,0,formatTimeStamp(new Date),"["+Debug.rand+" PMJS TRACE]"]),Debug.consoleLog.apply(Debug.console,arguments))}catch(e){Debug.consoleWarn("Error logging :(",e)}},Debug.logInfo=function(){try{Debug.enabled&&Debug.level<=1&&(Array.prototype.splice.apply(arguments,[0,0,formatTimeStamp(new Date),"["+Debug.rand+" PMJS INFO ]"]),Debug.consoleLog.apply(Debug.console,arguments))}catch(e){Debug.consoleWarn("Error logging :(",e)}},Debug.logWarn=function(){try{Debug.enabled&&Debug.level<=2&&(Array.prototype.splice.apply(arguments,[0,0,formatTimeStamp(new Date),"["+Debug.rand+" PMJS WARN ]"]),Debug.consoleWarn.apply(Debug.console,arguments))}catch(e){Debug.consoleWarn("Error logging :(",e)}},Debug.logError=function(){try{Debug.enabled&&Debug.level<=3&&(Array.prototype.splice.apply(arguments,[0,0,formatTimeStamp(new Date),"["+Debug.rand+" PMJS ERROR]"]),Debug.consoleError.apply(Debug.console,arguments))}catch(e){Debug.consoleWarn("Error logging :(",e)}};
},{}],8:[function(require,module,exports){
"use strict";var SmokeSignals=function(){this.init.apply(this,arguments)};exports.SmokeSignals=SmokeSignals,SmokeSignals.prototype.init=function(){},SmokeSignals.convert=function(t,n){return n={},t.on=function(o,i,e){return void 0===e&&(e=t),(n[o]=n[o]||[]).push([i,e]),t},t.off=function(o,i){for(var e=n[o],r=0;i&&e&&e[r];r++)e[r][0]===i&&e.splice(r--,1);return r||delete n[o],t},t.emit=function(o,i){var e=n[o];e&&(e=e.slice());for(var r=0;e&&e[r]&&(arguments[0]={target:t,stopPropagation:!1,type:o,data:i||{}},e[r][0].apply(e[r][1],arguments),!arguments[0].stopPropagation);r++);return t},t};
},{}],9:[function(require,module,exports){
"use strict";function AdProvider(){this.init.apply(this,arguments)}exports.AdProvider=AdProvider;var Config=require("../app/Config").Config,Debug=require("../dev/Debug").Debug,SmokeSignals=require("../events/SmokeSignals").SmokeSignals,AdRequest=require("../requests/AdRequest").AdRequest,ServerRequest=require("../requests/ServerRequest").ServerRequest,Timer=require("../util/Timer").Timer,Util=require("../util/Util").Util;AdProvider.BEST_AD_READY="bestAdReady",AdProvider.ALL_REQUESTS_COMPLETE="allRequestsComplete",AdProvider.prototype.tags,AdProvider.prototype.adRequests,AdProvider.prototype.adRequestsComplete,AdProvider.prototype.timer,AdProvider.prototype.intermediateTimedOut,AdProvider.prototype.bestFound,AdProvider.prototype.main,AdProvider.prototype.init=function(e,t){SmokeSignals.convert(this),this.tags=e,this.adRequests=[],this.adRequestsComplete=0,this.timer=new Timer(1e3*Config.TIMEOUT_INTERMEDIATE_TAGS,1),this.intermediateTimedOut=!1,this.bestFound=!1,this.main=t},AdProvider.prototype.open=function(){var e;for(e=0;e<this.tags.length;e++){var t=new AdRequest(this.main,this.tags[e],e);t.on(ServerRequest.COMPLETE,this.adRequestComplete,this),Debug.logInfo("("+e+") Sending ad request, url="+t.url),this.adRequests.push(t)}for(e=0;e<this.adRequests.length;e++)this.adRequests[e].open();this.timer.delay>0&&(this.timer.on(Timer.TIMER_COMPLETE,this.onIntermediateTimeout,this),this.timer.start())},AdProvider.prototype.getBestCompletedAdResponse=function(e){void 0===e&&(e=!1);for(var t=null,i=null,r=null,s=null,a=0;a<this.adRequests.length;a++){var n=this.adRequests[a],l=n.adResponse;if(n.status===ServerRequest.STATUS_COMPLETE&&"OK"===l.status&&!l.alreadyProcessed&&!l.alreadyPlayed){if(l.getProbablyPlayableCreatives().length>0)return l;l.getMaybePlayableCreatives().length>0&&null===t?t=l:l.getFlashPlayableCreatives().length>0&&null===i?i=l:!e&&l.getVPAIDCreatives().length>0&&null===r?r=l:!e&&l.getVPAIDFlashCreatives().length>0&&null===s&&(s=l)}}return null!==t?t:null!==i?i:null!==r?r:s},AdProvider.prototype.getBestAdResponse=function(){for(var e=null,t=null,i=null,r=null,s="0",a=!1,n=0;n<this.adRequests.length;n++){var l=this.adRequests[n],o=l.adResponse;if(l.tag.bucket!==s){if(a||null!==e||null!==t||null!==i||null!==r)break;s=l.tag.bucket,a=!1}if(l.status===ServerRequest.STATUS_LOADING)a=!0;else if(l.status===ServerRequest.STATUS_COMPLETE&&"OK"===o.status&&!o.alreadyProcessed&&!o.alreadyPlayed){if(o.getProbablyPlayableCreatives().length>0)return o;o.getMaybePlayableCreatives().length>0&&null===e?e=o:o.getFlashPlayableCreatives().length>0&&null===t?t=o:o.getVPAIDCreatives().length>0&&null===i?i=o:o.getVPAIDFlashCreatives().length>0&&null===r&&(r=o)}}if(null!==e)return e;if(null!==t)return t;var u=this.getBestCompletedAdResponse(!0);return null===u||Config.FORCE_BUCKET_ORDER?null!==i?i:r:u},AdProvider.prototype.onIntermediateTimeout=function(){if(this.timer.stop(),this.timer.off(Timer.TIMER_COMPLETE,this.onIntermediateTimeout),!this.bestFound){var e=this.getBestCompletedAdResponse();null===e?Debug.logWarn("Intermediate timeout of "+Config.TIMEOUT_INTERMEDIATE_TAGS+" seconds expired, but no ads found"):emit(AdProvider.BEST_AD_READY,e)}this.intermediateTimedOut=!0},AdProvider.prototype.allCompleteForBucket=function(e){for(var t=0;t<this.adRequests.length;t++){var i=this.adRequests[t];if(i.tag.bucket===e&&(i.status===ServerRequest.STATUS_PENDING||i.status===ServerRequest.STATUS_LOADING))return!1}return!0},AdProvider.prototype.adRequestComplete=function(e){var t=e.target,i=t.adResponse;if(i.elapsedTime=t.totalDuration,"INSECURE_URL"===i.status)this.main.addNoAdCreative(i.tag.cid);else if(t.additionalStatus===AdRequest.STATUS_PARSING_ERROR)Util.triggerErrorTracking(i,100),i.status="ERROR_PARSE",Config.USE_LEGACY_LOGIC&&this.main.setTrackingPixel(i.tag.tracking,i.tag.trackingp,"3","&vec=100"),this.main.addNoAdCreative(i.tag.cid);else if(t.additionalStatus===AdRequest.STATUS_WRAPPER_TIMEOUT)Util.triggerErrorTracking(i,301),i.status="ERROR_WRAPPER_TIMEOUT",Config.USE_LEGACY_LOGIC&&this.main.setTrackingPixel(i.tag.tracking,i.tag.trackingp,"3","&vec=301"),this.main.addNoAdCreative(i.tag.cid);else if(t.additionalStatus===AdRequest.STATUS_WRAPPER_LIMIT_REACHED)Util.triggerErrorTracking(i,302),i.status="ERROR_WRAPPER_LIMIT",Config.USE_LEGACY_LOGIC&&this.main.setTrackingPixel(i.tag.tracking,i.tag.trackingp,"3","&vec=302"),this.main.addNoAdCreative(i.tag.cid);else if(t.status===ServerRequest.STATUS_COMPLETE)if(i.isInLine||i.isWrapper)if(Config.SECURE_URL&&i.hasInsecureURLs)i.status="INSECURE_URL",this.main.addNoAdCreative(i.tag.cid);else if(i.getAllSupportedCreatives().length>0){i.status="OK";var r=[];(i.getProbablyPlayableCreatives().length>0||i.getMaybePlayableCreatives().length>0)&&r.push("HTML5_VIDEO"),i.getFlashPlayableCreatives(!0).length>0&&r.push("FLASH_VIDEO"),i.getVPAIDCreatives().length>0&&r.push("JS_ADMANAGER"),i.getVPAIDFlashCreatives(!0).length>0&&r.push("FLASH_ADMANAGER"),i.error=r.join("|");var s=this.getBestAdResponse();null===s||i.serverOrder!==s.serverOrder&&!this.allCompleteForBucket(s.tag.bucket)||(this.bestFound=!0,this.emit(AdProvider.BEST_AD_READY,s))}else Util.triggerErrorTracking(i,403),i.getAllSupportedCreatives(!0).length>0?i.status="UNSUPPORTED_FLASH":i.status="UNSUPPORTED",Config.LOG_XML_CONTENT&&i.results.length>0&&(i.error=i.results[i.results.length-1]),Config.USE_LEGACY_LOGIC&&this.main.setTrackingPixel(i.tag.tracking,i.tag.trackingp,"3","&vec=403"),this.main.addNoAdCreative(i.tag.cid);else Util.triggerErrorTracking(i,303),i.status="NO_ADS",Config.USE_LEGACY_LOGIC&&(this.main.setTrackingPixel(i.tag.tracking,i.tag.trackingp,"3","&vec=303"),this.main.setTrackingPixel(i.tag.tracking,i.tag.trackingp,"4")),this.main.addNoAdCreative(i.tag.cid);else Util.triggerErrorTracking(i,900),t.status===ServerRequest.STATUS_TIMEOUT?(i.status="ERROR_TIMEOUT",Config.USE_LEGACY_LOGIC&&(this.main.setTrackingPixel(i.tag.tracking,i.tag.trackingp,"1"),this.main.setTrackingPixel(i.tag.tracking,i.tag.trackingp,"3","&vec=900")),this.main.addNoAdCreative(i.tag.cid)):(i.status="ERROR_HTTP_"+t.httpStatus,i.error=t.errorText+" (url="+(t.url?'"'+t.url+'"':"null")+")",Config.USE_LEGACY_LOGIC&&(this.main.setTrackingPixel(i.tag.tracking,i.tag.trackingp,"4"),this.main.setTrackingPixel(i.tag.tracking,i.tag.trackingp,"3","&vec=900")),this.main.addNoAdCreative(i.tag.cid));t.off(ServerRequest.COMPLETE,this.adRequestComplete),this.adRequestsComplete++,this.isAllRequestsComplete()&&(this.timer.stop(),this.timer.off(Timer.TIMER_COMPLETE,this.onIntermediateTimeout),Debug.logInfo("All ad requests completed"),this.emit(AdProvider.ALL_REQUESTS_COMPLETE),Util.triggerOurAdRequestTracking(this.adRequests,this.main.isClientMode))},AdProvider.prototype.isAllRequestsComplete=function(){return this.adRequestsComplete===this.tags.length};
},{"../app/Config":5,"../dev/Debug":7,"../events/SmokeSignals":8,"../requests/AdRequest":10,"../requests/ServerRequest":13,"../util/Timer":15,"../util/Util":16}],10:[function(require,module,exports){
"use strict";function AdRequest(){this.init.apply(this,arguments)}var ServerRequest=require("../requests/ServerRequest").ServerRequest;AdRequest.prototype=Object.create(ServerRequest.prototype),AdRequest.prototype.constructor=AdRequest,AdRequest.prototype.super=ServerRequest.prototype,exports.AdRequest=AdRequest;var Config=require("../app/Config").Config,Debug=require("../dev/Debug").Debug,AdRequestFlash=require("../requests/AdRequestFlash").AdRequestFlash,AdResponse=require("../xml/AdResponse").AdResponse;AdRequest.STATUS_PARSING_ERROR="statusParsingError",AdRequest.STATUS_WRAPPER_TIMEOUT="statusWrapperTimeout",AdRequest.STATUS_WRAPPER_LIMIT_REACHED="statusWrapperLimitReached",AdRequest.prototype.main,AdRequest.prototype.tag,AdRequest.prototype.additionalStatus,AdRequest.prototype.order,AdRequest.prototype.wrapperDepth,AdRequest.prototype.adResponse,AdRequest.prototype.adRequestFlash,AdRequest.prototype.init=function(e,t,s){ServerRequest.prototype.init.call(this),this.main=e,this.tag=t,this.additionalStatus="",this.order=s,this.wrapperDepth=0,this.adResponse=null,this.on(ServerRequest.COMPLETE,this.adRequestComplete,this),this.url=t.url,this.timer.delay=1e3*Config.TIMEOUT_ADSOURCE,this.adResponse=new AdResponse(t,s),this.adRequestFlash=null},AdRequest.prototype.open=function(e){Config.SECURE_URL&&this.adResponse.hasInsecureURLs?(this.status=ServerRequest.STATUS_COMPLETE,this.adResponse.status="INSECURE_URL",this.emit(ServerRequest.COMPLETE)):ServerRequest.prototype.open.call(this,e)},AdRequest.prototype.adRequestComplete=function(e){var t=!1;if(this.status===ServerRequest.STATUS_COMPLETE){if("INSECURE_URL"===this.adResponse.status)return void this.off(ServerRequest.COMPLETE,this.adRequestComplete);try{this.adResponse.results.push(this.result);var s=this.resultXML;null===s&&(s=(new DOMParser).parseFromString(this.result,"text/xml")),this.adResponse.processXML(s),Debug.logTrace("("+this.order+(this.wrapperDepth>0?"-w"+this.wrapperDepth:"")+") Got ad response"),this.adResponse.isWrapper&&(this.wrapperDepth<Config.WRAPPER_LIMIT?(this.wrapperDepth++,e.stopPropagation=!0,t=!0,this.url=this.adResponse.wrapperUrl,this.timer.delay-=this.totalDuration,this.timer.delay>0?(this.status=ServerRequest.STATUS_PENDING,this.open(),Debug.logInfo("("+this.order+"-w"+this.wrapperDepth+") Following wrapper, url="+this.url)):(Debug.logWarn("("+this.order+"-w"+this.wrapperDepth+") Found wrapper but timeout of "+Config.TIMEOUT_ADSOURCE+" seconds expired"),this.additionalStatus=AdRequest.STATUS_WRAPPER_TIMEOUT)):(Debug.logWarn("("+this.order+"-w"+this.wrapperDepth+") Found wrapper but limit of "+Config.WRAPPER_LIMIT+" reached"),this.additionalStatus=AdRequest.STATUS_WRAPPER_LIMIT_REACHED))}catch(e){this.status=ServerRequest.STATUS_ERROR,Debug.logError("Can't parse ad response, url="+this.url+", ex="+e+"\n"+this.result,e),this.additionalStatus=AdRequest.STATUS_PARSING_ERROR}}0===this.httpStatus&&Config.FLASH&&null===this.adRequestFlash&&(e.stopPropagation=!0,t=!0,this.timer.delay-=this.totalDuration,this.adRequestFlash=new AdRequestFlash(this.main,this),this.adRequestFlash.open()),t||this.off(ServerRequest.COMPLETE,this.adRequestComplete)},AdRequest.prototype.adRequestCompleteFlash=function(e,t,s,r,i,o){var a,p;if(e)for(this.status=s,this.httpStatus=r,this.errorText=i,this.timer.delay=o,this.totalDuration=0,a=0;a<t.length;a++){this.result=t[0];try{var u=new DOMParser;this.resultXML=u.parseFromString(this.result,"text/xml")}catch(e){}var h={stopPropagation:!1};if(this.adRequestComplete(h),!h.stopPropagation)break}for(this.adResponse.results=t,a=0;a<this.adResponse.inLineLinearCreatives.length;a++){var R=this.adResponse.inLineLinearCreatives[a];for(p=0;p<R.mediaFiles.length;p++)R.mediaFiles[p].onlyFlash=!0}this.emit(ServerRequest.COMPLETE)};
},{"../app/Config":5,"../dev/Debug":7,"../requests/AdRequestFlash":11,"../requests/ServerRequest":13,"../xml/AdResponse":20}],11:[function(require,module,exports){
"use strict";function AdRequestFlash(){this.init.apply(this,arguments)}exports.AdRequestFlash=AdRequestFlash;var Config=require("../app/Config").Config,Debug=require("../dev/Debug").Debug,Timer=require("../util/Timer").Timer,Util=require("../util/Util").Util;AdRequestFlash.flash=null,AdRequestFlash.flashContainerId=null,AdRequestFlash.flashRequestsQueue=[],AdRequestFlash.environmentVars={},AdRequestFlash.flashReadyTimer=null,AdRequestFlash.flashError=!1,AdRequestFlash.cleanUpCalled=!1,AdRequestFlash.prototype.main,AdRequestFlash.prototype.adRequest,AdRequestFlash.prototype.callback,AdRequestFlash.initFlash=function(e){if(null===AdRequestFlash.flash&&null===AdRequestFlash.flashContainerId){AdRequestFlash.flashContainerId="adRequestFlashHelper",AdRequestFlash.environmentVars.item=document.createElement("div"),AdRequestFlash.environmentVars.item.classList.add("item"),e.stage.slotsContainer.appendChild(AdRequestFlash.environmentVars.item),AdRequestFlash.environmentVars.slot=document.createElement("div"),AdRequestFlash.environmentVars.slot.classList.add("flashHelper"),AdRequestFlash.environmentVars.slot.setAttribute("id",AdRequestFlash.flashContainerId),AdRequestFlash.environmentVars.item.appendChild(AdRequestFlash.environmentVars.slot);var s={};for(var t in e.parameters)e.parameters.hasOwnProperty(t)&&(s[t]=e.parameters[t]);s.tags="ONLY_REQUESTS",s.debug_rand=Debug.rand,swfobject.embedSWF(Config.FLASH,AdRequestFlash.flashContainerId,"1","1","10.0.0",void 0,s,{allowScriptAccess:"always",allowFullScreen:"true",wmode:"transparent"},{},function(e){e.success?(AdRequestFlash.flashReadyTimer=new Timer(100,10*Config.TIMEOUT_SWF_LOADER),AdRequestFlash.flashReadyTimer.on(Timer.TIMER,AdRequestFlash.flashReadyTimeout),AdRequestFlash.flashReadyTimer.on(Timer.TIMER_COMPLETE,AdRequestFlash.flashReadyTimeoutLast),AdRequestFlash.flashReadyTimer.start()):(AdRequestFlash.flashError=!0,AdRequestFlash.processQueue())})}},AdRequestFlash.flashReadyTimeout=function(){swfobject.getObjectById(AdRequestFlash.flashContainerId)&&swfobject.getObjectById(AdRequestFlash.flashContainerId).executeAdRequestEI&&(AdRequestFlash.flash=swfobject.getObjectById(AdRequestFlash.flashContainerId),AdRequestFlash.flashReadyTimer.stop(),AdRequestFlash.flashReadyTimer.off(Timer.TIMER,AdRequestFlash.flashReadyTimeout),AdRequestFlash.flashReadyTimer.off(Timer.TIMER_COMPLETE,AdRequestFlash.flashReadyTimeoutLast),AdRequestFlash.processQueue())},AdRequestFlash.flashReadyTimeoutLast=function(){swfobject.getObjectById(AdRequestFlash.flashContainerId)&&swfobject.getObjectById(AdRequestFlash.flashContainerId).executeAdRequestEI?(AdRequestFlash.flash=swfobject.getObjectById(AdRequestFlash.flashContainerId),AdRequestFlash.flashReadyTimer.stop(),AdRequestFlash.flashReadyTimer.off(Timer.TIMER,AdRequestFlash.flashReadyTimeout),AdRequestFlash.flashReadyTimer.off(Timer.TIMER_COMPLETE,AdRequestFlash.flashReadyTimeoutLast),AdRequestFlash.processQueue()):(AdRequestFlash.flashError=!0,AdRequestFlash.processQueue())},AdRequestFlash.processQueue=function(){for(AdRequestFlash.cleanUpCalled&&AdRequestFlash.cleanupEverything();AdRequestFlash.flashRequestsQueue.length>0;){if(null===AdRequestFlash.flash&&!AdRequestFlash.flashError&&!AdRequestFlash.cleanUpCalled)return void AdRequestFlash.initFlash(AdRequestFlash.flashRequestsQueue[0].adRequest.main);var e=AdRequestFlash.flashRequestsQueue.shift();AdRequestFlash.flashError||AdRequestFlash.cleanUpCalled?e.adRequestComplete(!1):(e.callback="adRequestFlashCallback"+e.adRequest.order,document[e.callback]=Util.bind(e.adRequestComplete,e),AdRequestFlash.flash.executeAdRequestEI(encodeURIComponent(e.adRequest.url),encodeURIComponent(e.adRequest.order),encodeURIComponent(e.adRequest.wrapperDepth),encodeURIComponent(e.adRequest.timer.delay),encodeURIComponent("document."+e.callback)))}},AdRequestFlash.cleanupEverything=function(){if(AdRequestFlash.cleanUpCalled=!0,null!==AdRequestFlash.flash){swfobject.removeSWF(AdRequestFlash.flashContainerId);try{AdRequestFlash.environmentVars.item.parentNode.removeChild(AdRequestFlash.environmentVars.item)}catch(e){}AdRequestFlash.flash=null}},AdRequestFlash.prototype.init=function(e,s){this.main=e,this.adRequest=s,this.callback=null},AdRequestFlash.prototype.open=function(){AdRequestFlash.flashRequestsQueue.push(this),AdRequestFlash.processQueue()},AdRequestFlash.prototype.adRequestComplete=function(e,s,t,a,l,d){delete document[this.callback],e?(s=JSON.parse(decodeURIComponent(s)),t=decodeURIComponent(t),a=parseInt(decodeURIComponent(a)),l=decodeURIComponent(l),d=decodeURIComponent(d)):s=[],this.adRequest.adRequestCompleteFlash(e,s,t,a,l,d)};
},{"../app/Config":5,"../dev/Debug":7,"../util/Timer":15,"../util/Util":16}],12:[function(require,module,exports){
"use strict";function JsLoader(){this.init.apply(this,arguments)}exports.JsLoader=JsLoader;var Config=require("../app/Config").Config,Debug=require("../dev/Debug").Debug,SmokeSignals=require("../events/SmokeSignals").SmokeSignals,Timer=require("../util/Timer").Timer;JsLoader.COMPLETE="eventComplete",JsLoader.ERROR="eventError",JsLoader.TIMEOUT="eventTimeout",JsLoader.prototype.iframe,JsLoader.prototype.url,JsLoader.prototype.timer,JsLoader.prototype.init=function(){SmokeSignals.convert(this),this.iframe=null,this.url="",this.timer=new Timer(1e3*Config.TIMEOUT_SWF_LOADER,1)},JsLoader.prototype.load=function(e,t){this.url=t,this.timer.delay>0&&(this.timer.on(Timer.TIMER_COMPLETE,this.onTimeoutExceeded,this),this.timer.start()),this.iframe=document.createElement("iframe"),this.iframe.setAttribute("frameborder","0"),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("marginwidth","0"),this.iframe.setAttribute("marginheight","0"),this.iframe.setAttribute("allowtransparency","true"),this.iframe.setAttribute("style","border:none;width:100%;height:100%;margin:0;padding:0;position:absolute;top:0;left:0;");var i=this;this.iframe.onload=function(){var e=i.iframe.contentWindow.document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=Config.CSS,i.iframe.contentWindow.document.head.appendChild(e);var t=i.iframe.contentWindow.document.createElement("script");t.type="text/javascript",t.src=i.url,t.onload=function(){i.cancelTimeoutTimer(),i.emit(JsLoader.COMPLETE)},t.onerror=function(){i.cancelTimeoutTimer(),i.emit(JsLoader.ERROR)},i.iframe.contentWindow.document.head.appendChild(t)},e.appendChild(this.iframe)},JsLoader.prototype.cancelTimeoutTimer=function(){this.timer.stop(),this.timer.off(Timer.TIMER_COMPLETE,this.onTimeoutExceeded)},JsLoader.prototype.close=function(){if(this.cancelTimeoutTimer(),this.iframe)try{document.body.removeChild(this.iframe)}catch(e){}},JsLoader.prototype.onTimeoutExceeded=function(){Debug.logWarn("Timeout exceeded ("+this.timer.delay/1e3+"s) requesting URL: "+(this.url?this.url:"(unavailable)")),this.close(),this.emit(JsLoader.TIMEOUT)};
},{"../app/Config":5,"../dev/Debug":7,"../events/SmokeSignals":8,"../util/Timer":15}],13:[function(require,module,exports){
"use strict";function ServerRequest(){this.init.apply(this,arguments)}exports.ServerRequest=ServerRequest;var Config=require("../app/Config").Config,Debug=require("../dev/Debug").Debug,SmokeSignals=require("../events/SmokeSignals").SmokeSignals,Timer=require("../util/Timer").Timer,Util=require("../util/Util").Util;ServerRequest.COMPLETE="eventComplete",ServerRequest.STATUS_PENDING="statusPending",ServerRequest.STATUS_LOADING="statusLoading",ServerRequest.STATUS_COMPLETE="statusComplete",ServerRequest.STATUS_TIMEOUT="statusTimeout",ServerRequest.STATUS_ERROR="statusError",ServerRequest.prototype.url,ServerRequest.prototype.method,ServerRequest.prototype.status,ServerRequest.prototype.loader,ServerRequest.prototype.timer,ServerRequest.prototype.httpStatus,ServerRequest.prototype.errorText,ServerRequest.prototype.result,ServerRequest.prototype.resultXML,ServerRequest.prototype.requestStartTime,ServerRequest.prototype.responseLatency,ServerRequest.prototype.totalDuration,ServerRequest.prototype.contentType,ServerRequest.prototype.init=function(){SmokeSignals.convert(this),this.url="",this.method="GET",this.status=ServerRequest.STATUS_PENDING,this.loader=new XMLHttpRequest,this.loader.serverRequest=this,this.timer=new Timer(5e3,1),this.httpStatus=0,this.errorText="",this.result=null,this.resultXML=null,this.requestStartTime=0,this.responseLatency=0,this.totalDuration=0,this.contentType=null},ServerRequest.prototype.open=function(e){if(this.status=ServerRequest.STATUS_LOADING,!this.url||"http"!==this.url.substr(0,4))return Debug.logWarn("ServerRequest invalid url="+(this.url?'"'+this.url+'"':"null")),void this.onInvalidRequestURL();this.timer.delay>0&&(this.timer.on(Timer.TIMER_COMPLETE,this.onRequestTimeout,this),this.timer.start()),this.loader.onreadystatechange=function(e){switch(this.readyState){case XMLHttpRequest.OPENED:ServerRequest.prototype.onLoadOpen.apply(this.serverRequest,[]);break;case XMLHttpRequest.DONE:ServerRequest.prototype.onLoadComplete.apply(this.serverRequest,[])}},this.requestStartTime=(new Date).getTime(),this.loader.open(this.method,this.url,!0),null!==this.contentType&&this.loader.setRequestHeader("Content-Type",this.contentType),e?this.loader.send(Util.urlEncodeParams(e)):this.loader.send()},ServerRequest.prototype.onInvalidRequestURL=function(){this.status=ServerRequest.STATUS_ERROR,this.errorText="Error: Invalid URL",this.onCompleteRequest()},ServerRequest.prototype.onLoadOpen=function(){this.responseLatency=(new Date).getTime()-this.requestStartTime},ServerRequest.prototype.onLoadComplete=function(){this.totalDuration=(new Date).getTime()-this.requestStartTime,this.httpStatus=this.loader.status,Debug.logTrace("HTTP complete latency="+this.responseLatency/1e3+"s duration="+this.totalDuration/1e3+"s httpStatus="+this.httpStatus+" url="+this.url),this.status===ServerRequest.STATUS_LOADING&&(null!==this.loader.response&&this.httpStatus>=200&&this.httpStatus<300?(this.status=ServerRequest.STATUS_COMPLETE,this.result=this.loader.response,this.resultXML=this.loader.responseXML):this.status=ServerRequest.STATUS_ERROR,this.timer.stop(),this.loader.onreadystatechange=null,this.onCompleteRequest())},ServerRequest.prototype.onRequestTimeout=function(){this.status===ServerRequest.STATUS_LOADING&&(this.status=ServerRequest.STATUS_TIMEOUT,this.errorText="Error: HTTP request timed out in "+this.timer.delay+"ms.",Debug.logWarn(this.errorText+" url="+this.url),this.onCompleteRequest())},ServerRequest.prototype.onCompleteRequest=function(){this.disposeRequest(),this.emit(ServerRequest.COMPLETE)},ServerRequest.prototype.disposeRequest=function(){if(this.timer.stop(),this.timer.off(Timer.TIMER_COMPLETE,this.onRequestTimeout),this.status===ServerRequest.STATUS_LOADING||this.status===ServerRequest.STATUS_TIMEOUT){this.status===ServerRequest.STATUS_LOADING&&(this.status=ServerRequest.STATUS_ERROR);try{this.loader.abort()}catch(e){}}},ServerRequest.prototype.removeRequestEventListeners=function(){this.loader.onreadystatechange=null},ServerRequest.prototype.destroy=function(){this.disposeRequest()};
},{"../app/Config":5,"../dev/Debug":7,"../events/SmokeSignals":8,"../util/Timer":15,"../util/Util":16}],14:[function(require,module,exports){
"use strict";function TagsRequest(){this.init.apply(this,arguments)}var ServerRequest=require("../requests/ServerRequest").ServerRequest;TagsRequest.prototype=Object.create(ServerRequest.prototype),TagsRequest.prototype.constructor=TagsRequest,TagsRequest.prototype.super=ServerRequest.prototype,exports.TagsRequest=TagsRequest;var Config=require("../app/Config").Config,Debug=require("../dev/Debug").Debug,Util=require("../util/Util").Util;TagsRequest.prototype.resultTags,TagsRequest.prototype.init=function(){ServerRequest.prototype.init.call(this),this.resultTags=null,this.on(ServerRequest.COMPLETE,this.tagsRequestComplete),this.url=Config.TAGS_URL+"&pageUrl="+encodeURIComponent(Util.getTopPageUrl()),this.timer.delay=1e3*Config.TIMEOUT_TAGS},TagsRequest.prototype.tagsRequestComplete=function(){if(this.off(ServerRequest.COMPLETE,this.tagsRequestComplete),this.status===ServerRequest.STATUS_COMPLETE)try{this.resultTags=JSON.parse(this.result)}catch(e){this.status=ServerRequest.STATUS_ERROR,Debug.logError("Can't parse tags response, url="+this.url+", ex="+e+"\n"+this.result,e)}};
},{"../app/Config":5,"../dev/Debug":7,"../requests/ServerRequest":13,"../util/Util":16}],15:[function(require,module,exports){
"use strict";function Timer(){this.init.apply(this,arguments)}exports.Timer=Timer;var SmokeSignals=require("../events/SmokeSignals").SmokeSignals,Util=require("../util/Util").Util;Timer.TIMER="timer",Timer.TIMER_COMPLETE="timerComplete",Timer.prototype.currentCount,Timer.prototype.delay,Timer.prototype.repeatCount,Timer.prototype.running,Timer.prototype.intervalId,Timer.prototype.startTime,Timer.prototype.remaningTime,Timer.prototype.init=function(t,i){SmokeSignals.convert(this),void 0===i&&(i=0),this.currentCount=0,this.delay=t,this.repeatCount=i,this.running=!1,this.intervalId=null,this.startTime=0,this.remaningTime=0},Timer.prototype.start=function(){!this.running&&(0===this.repeatCount||this.currentCount<this.repeatCount)&&(this.startTime=(new Date).getTime(),this.intervalId=setInterval(Util.bind(this.timeout,this),this.delay),this.running=!0)},Timer.prototype.resume=function(){!this.running&&(0===this.repeatCount||this.currentCount<this.repeatCount)&&(this.intervalId=setInterval(Util.bind(this.timeout,this),this.remaningTime),this.running=!0)},Timer.prototype.stop=function(){this.running&&(this.remaningTime=this.delay-((new Date).getTime()-this.startTime),clearInterval(this.intervalId),this.running=!1)},Timer.prototype.reset=function(){this.stop(),this.currentCount=0},Timer.prototype.timeout=function(){this.currentCount++,this.emit(Timer.TIMER),0!==this.repeatCount&&this.currentCount>=this.repeatCount&&(this.stop(),this.emit(Timer.TIMER_COMPLETE))};
},{"../events/SmokeSignals":8,"../util/Util":16}],16:[function(require,module,exports){
"use strict";var Util=function(){this.init.apply(this,arguments)};exports.Util=Util;var Config=require("../app/Config").Config,Debug=require("../dev/Debug").Debug,ServerRequest=require("../requests/ServerRequest").ServerRequest,Timer=require("../util/Timer").Timer;Util.REGEX_ERRORCODE=/\[ERRORCODE]/gi,Util.REGEX_CACHEBUSTING=/\[CACHEBUSTING]/gi,Util.prototype.init=function(){},Util.triggerErrorTracking=function(e,r){try{var i=e?e.errors.length:0;Debug.logTrace("("+e.serverOrder+") Triggering "+i+" error trackings, errorCode="+r);for(var t=0;t<i;t++)Util.triggerTracking(e.errors[t].replace(Util.REGEX_ERRORCODE,r))}catch(e){}},Util.triggerImpressionTracking=function(e){try{var r=e?e.impressions.length:0;Debug.logTrace("("+e.serverOrder+") Triggering "+r+" impression trackings");for(var i=0;i<r;i++)Util.triggerTracking(e.impressions[i])}catch(e){}},Util.triggerCreativeTracking=function(e,r,i,t,l){void 0===t&&(t=-1),void 0===l&&(l=-1);try{var o,n=[];if(null!==e.wrapperLinearCreative)for(o=0;o<e.wrapperLinearCreative.trackingEvents.length;o++)e.wrapperLinearCreative.trackingEvents[o].event===i&&n.push(e.wrapperLinearCreative.trackingEvents[o]);for(o=0;o<r.trackingEvents.length;o++)r.trackingEvents[o].event===i&&n.push(r.trackingEvents[o]);var a=n.length,c=0;for(o=0;o<a;o++){var g=n[o];if(!g.fired){var u=g.url;-1!==t&&-1!==g.milliseconds&&t>=g.milliseconds||-1!==l&&-1!==g.percentage&&l>=g.percentage?(c++,Util.triggerTracking(u),g.fired=!0):(c++,Util.triggerTracking(u))}}Debug.logTrace("("+e.serverOrder+") Triggering "+c+" creative trackings, event="+i),Util.callTrackingCallback(i,e.tag.url,e.tag.advid,e.tag.campid,e.tag.cid,e.tag.price)}catch(e){}},Util.triggerCreativeClickTracking=function(e,r,i){try{var t,l=[];if(null!==e.wrapperLinearCreative)for(t=0;t<e.wrapperLinearCreative.videoClicksTracking.length;t++)l.push(e.wrapperLinearCreative.videoClicksTracking[t]);for(t=0;t<r.videoClicksTracking.length;t++)l.push(r.videoClicksTracking[t]);var o=l.length;for(Debug.logTrace("("+e.serverOrder+") Triggering "+o+" creative click trackings"),t=0;t<o;t++)Util.triggerTracking(l[t]);Util.callTrackingCallback(i,e.tag.url,e.tag.advid,e.tag.campid,e.tag.cid,e.tag.price)}catch(e){}},Util.triggerTracking=function(e){if(null!==e){e=e.replace(Util.REGEX_CACHEBUSTING,Math.floor(9e7*Math.random())+1e7);var r=new ServerRequest;r.timeout=1e3*Config.TIMEOUT_VAST_TRACKING,r.url=e,r.open()}},Util.setTrackingPixel=function(e){setPixel(e,"TRACK")},Util.setTrackingPixelPost=function(e,r){setPostPixel(e,Util.urlEncodeParams(r))},Util.callTrackingCallback=function(e,r,i,t,l,o){try{Config.TRACKING_CALLBACK&&"function"==typeof window[Config.TRACKING_CALLBACK]&&window[Config.TRACKING_CALLBACK](e,r,i,t,l,o)}catch(e){}},Util.urlEncodeParams=function(e){var r=[];for(var i in e)e.hasOwnProperty(i)&&r.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return r.join("&")},Util.triggerOurAdRequestTracking=function(e,r){if(e.length>0&&e[0].adResponse.tag.hasOwnProperty("tracking")){for(var i={},t=0;t<e.length;t++){var l=e[t],o=l.adResponse;i["p"+t]=o.tag.trackingp,i["msg"+t]="AD_REQUEST "+o.status,i["msgl"+t]="",i["time"+t]=0,i["timel"+t]=0,i["sero"+t]=o.serverOrder,i["playo"+t]=o.playOrder,i["buc"+t]=o.tag.bucket;var n=o.bid;i["msgp"+t]=o.elapsedTime+","+o.error+","+o.hasInsecureURLs+","+(null===n?",,":n.model+","+n.currency+","+n.value),Util.callTrackingCallback(i["msg"+t],o.tag.url,o.tag.advid,o.tag.campid,o.tag.cid,o.tag.price)}if(r)Util.setTrackingPixelPost(e[0].adResponse.tag.tracking,i);else{var a=new ServerRequest;a.url=e[0].adResponse.tag.tracking,a.method="POST",a.contentType="application/x-www-form-urlencoded",a.open(i)}}},Util.triggerOurTracking=function(e,r,i,t,l,o,n){if(void 0===n&&(n=null),e.tag.hasOwnProperty("tracking")){var a={};if(a.p=e.tag.trackingp,a.msg=i,a.msgl=t,a.time=l,a.timel=o,a.sero=e.serverOrder,a.playo=e.playOrder,a.buc=e.tag.bucket,null!==n&&n.length>0&&(a.msgp=JSON.stringify(n)),r){var c=e.tag.tracking;e.playedUsingFlashWrapper&&(c+=-1===c.indexOf("?")?"?fl=1":"&fl=1"),c+=(-1===c.indexOf("?")?"?":"&")+Util.urlEncodeParams(a),Util.setTrackingPixel(c)}else{var g=new ServerRequest;g.url=e.tag.tracking,e.playedUsingFlashWrapper&&(g.url+=-1===g.url.indexOf("?")?"?fl=1":"&fl=1"),g.url+=(-1===g.url.indexOf("?")?"?":"&")+Util.urlEncodeParams(a),g.open()}Util.callTrackingCallback(a.msg,e.tag.url,e.tag.advid,e.tag.campid,e.tag.cid,e.tag.price)}},Util.getTopPageUrl=function(){try{if(void 0!==window.location.ancestorOrigins)return 0===window.location.ancestorOrigins.length?window.location.href||window.document.location.href:window.location.ancestorOrigins[window.location.ancestorOrigins.length-1];for(var e="",r=window,i=0;null!==r&&i<100;){i++;try{e=r.location.href||r.document.location.href}catch(e){}r=window.top?r===window.top?null:r.parent:null}return e}catch(e){Debug.logWarn("Failed to retrieve TopPageUrl",e)}return""},Util.bind=function(e,r){return function(){return e.apply(r,arguments)}},Util.videoSupportsVolume=function(){var e=document.createElement("video");return e.volume=.5,.5===e.volume},Util.isURLInsecure=function(e){return"string"==typeof e&&0===e.indexOf("http:")},Util.forcedVolume=NaN,Util.forcedVolumeBeforeMute=NaN,Util.volumeCheckTimer=null,Util.videoElements=[],Util.startForceVolume=function(e){-1!==e&&(Util.setForceVolume(e),Util.volumeCheckTimer=new Timer(100,0),Util.volumeCheckTimer.on(Timer.TIMER,Util.forceVolume),Util.volumeCheckTimer.start())},Util.addVideoToForce=function(e,r){Util.removeVideoFromForce(e);var i={element:e,adResponse:r,originalVolume:e.volume,nextChange:!0,forceVolumeChanges:0,forceVolumeErrors:0};return Util.videoElements.push(i),i},Util.removeVideoFromForce=function(e){var r=Util.videoElements.indexOf(e);-1!==r&&Util.videoElements.splice(r,1)},Util.getForceVolume=function(){return Util.forcedVolume},Util.setForceVolume=function(e){Util.forcedVolumeBeforeMute=0===e?Util.forcedVolume:NaN,Util.forcedVolume=e;for(var r=0;r<Util.videoElements.length;r++)Util.videoElements[r].nextChange=!0;Util.forceVolume()},Util.stopForceVolume=function(){Util.volumeCheckTimer&&(Util.volumeCheckTimer.stop(),Util.volumeCheckTimer.off(Timer.TIMER)),Util.setForceVolume(NaN)},Util.forceVolume=function(){for(var e=0;e<Util.videoElements.length;e++){var r=Util.videoElements[e];try{var i=Util.forcedVolume;isNaN(i)&&(i=r.originalVolume),isNaN(i)||r.element.volume===i||(Debug.logWarn("("+r.adResponse.serverOrder+") Force volume to "+i+" from "+r.element.volume),r.element.volume=i,r.nextChange||r.forceVolumeChanges++)}catch(e){r.forceVolumeErrors++}r.nextChange=!1}},Util.forceVolumeMute=function(){isNaN(Util.forcedVolume)||(Util.forcedVolumeBeforeMute=Util.forcedVolume,Util.setForceVolume(0))},Util.forceVolumeUnmute=function(){isNaN(Util.forcedVolume)||(Util.setForceVolume(isNaN(Util.forcedVolumeBeforeMute)?0===Util.forcedVolume?1:Util.forcedVolume:Util.forcedVolumeBeforeMute),0===Util.forcedVolume&&Util.setForceVolume(1)),Util.forcedVolumeBeforeMute=NaN};
},{"../app/Config":5,"../dev/Debug":7,"../requests/ServerRequest":13,"../util/Timer":15}],17:[function(require,module,exports){
"use strict";function VolumeControl(){this.init.apply(this,arguments)}exports.VolumeControl=VolumeControl;var SmokeSignals=require("../events/SmokeSignals").SmokeSignals,Util=require("../util/Util").Util;VolumeControl.UNMUTE="UNMUTE",VolumeControl.MUTE="MUTE",VolumeControl.prototype.element,VolumeControl.prototype.init=function(t,e){SmokeSignals.convert(this),this.element=t,this[e?"setStateMuted":"setStateUnmuted"](!0),e&&Util.forceVolumeMute(),this.element.addEventListener("click",Util.bind(this.onClick,this))},VolumeControl.prototype.setStateUnmuted=function(t){this.element.classList.contains("muted")&&t&&(this.element.classList.remove("muted"),this.element.classList.add("normal"))},VolumeControl.prototype.setStateMuted=function(t){this.element.classList.contains("normal")&&t&&(this.element.classList.remove("normal"),this.element.classList.add("muted"))},VolumeControl.prototype.onClick=function(){this.element.classList.contains("normal")?(this.setStateMuted(!0),this.emit(VolumeControl.MUTE)):(this.setStateUnmuted(!0),this.emit(VolumeControl.UNMUTE))};
},{"../events/SmokeSignals":8,"../util/Util":16}],18:[function(require,module,exports){
"use strict";var VPAIDEvent=function(){this.init.apply(this,arguments)};exports.VPAIDEvent=VPAIDEvent,VPAIDEvent.AdLoaded="AdLoaded",VPAIDEvent.AdStarted="AdStarted",VPAIDEvent.AdStopped="AdStopped",VPAIDEvent.AdSkipped="AdSkipped",VPAIDEvent.AdLinearChange="AdLinearChange",VPAIDEvent.AdSizeChange="AdSizeChange",VPAIDEvent.AdExpandedChange="AdExpandedChange",VPAIDEvent.AdSkippableStateChange="AdSkippableStateChange",VPAIDEvent.AdRemainingTimeChange="AdRemainingTimeChange",VPAIDEvent.AdDurationChange="AdDurationChange",VPAIDEvent.AdVolumeChange="AdVolumeChange",VPAIDEvent.AdImpression="AdImpression",VPAIDEvent.AdVideoStart="AdVideoStart",VPAIDEvent.AdVideoFirstQuartile="AdVideoFirstQuartile",VPAIDEvent.AdVideoMidpoint="AdVideoMidpoint",VPAIDEvent.AdVideoThirdQuartile="AdVideoThirdQuartile",VPAIDEvent.AdVideoComplete="AdVideoComplete",VPAIDEvent.AdClickThru="AdClickThru",VPAIDEvent.AdInteraction="AdInteraction",VPAIDEvent.AdUserAcceptInvitation="AdUserAcceptInvitation",VPAIDEvent.AdUserMinimize="AdUserMinimize",VPAIDEvent.AdUserClose="AdUserClose",VPAIDEvent.AdPaused="AdPaused",VPAIDEvent.AdPlaying="AdPlaying",VPAIDEvent.AdLog="AdLog",VPAIDEvent.AdError="AdError",VPAIDEvent.prototype.init=function(){};
},{}],19:[function(require,module,exports){
"use strict";function VPAIDWrapper(){this.init.apply(this,arguments)}exports.VPAIDWrapper=VPAIDWrapper;var Debug=require("../dev/Debug").Debug,SmokeSignals=require("../events/SmokeSignals").SmokeSignals,Timer=require("../util/Timer").Timer,Util=require("../util/Util").Util,VPAIDEvent=require("../vpaid/VPAIDEvent").VPAIDEvent;VPAIDWrapper.prototype.ad,VPAIDWrapper.prototype.main,VPAIDWrapper.prototype.adResponse,VPAIDWrapper.prototype.prevAdVolume,VPAIDWrapper.prototype.estimatedDuration,VPAIDWrapper.prototype.stopAdTimer,VPAIDWrapper.prototype.overrideAdDurationOnException,VPAIDWrapper.prototype.stopAdCalled,VPAIDWrapper.prototype.timer,VPAIDWrapper.prototype.proxyListeners,VPAIDWrapper.prototype.videoSlot,VPAIDWrapper.prototype.init=function(t,e,i,r){if(void 0===r&&(r=!1),SmokeSignals.convert(this),this.main=e,this.adResponse=i,this.prevAdVolume=1,this.estimatedDuration=-1,this.stopAdTimer=null,this.overrideAdDurationOnException=NaN,this.stopAdCalled=!1,this.timer=null,this.proxyListeners={},r)this.ad=t,this.addProxyListeners();else try{var o=t.contentWindow.getVPAIDAd;if(!o||"function"!=typeof o)return void Debug.logWarn("("+this.adResponse.serverOrder+") AdManager has no getVPAIDAd function");if(this.ad=o(),!this.checkVPAIDInterface())return void Debug.logWarn("("+this.adResponse.serverOrder+") AdManager does not implement VPAID inerface");this.addProxyListeners()}catch(t){this.main.log3rdPartyException(this.adResponse,"VPAIDWrapper",t)}},VPAIDWrapper.prototype.checkVPAIDInterface=function(){return this.ad.handshakeVersion&&"function"==typeof this.ad.handshakeVersion&&this.ad.initAd&&"function"==typeof this.ad.initAd&&this.ad.startAd&&"function"==typeof this.ad.startAd&&this.ad.stopAd&&"function"==typeof this.ad.stopAd&&this.ad.skipAd&&"function"==typeof this.ad.skipAd&&this.ad.resizeAd&&"function"==typeof this.ad.resizeAd&&this.ad.pauseAd&&"function"==typeof this.ad.pauseAd&&this.ad.resumeAd&&"function"==typeof this.ad.resumeAd&&this.ad.expandAd&&"function"==typeof this.ad.expandAd&&this.ad.collapseAd&&"function"==typeof this.ad.collapseAd&&this.ad.subscribe&&"function"==typeof this.ad.subscribe&&this.ad.unsubscribe&&"function"==typeof this.ad.unsubscribe},VPAIDWrapper.prototype.proxySubscribe=function(t,e,i){try{this.proxyUnsubscribe(e),this.proxyListeners[e]=Util.bind(t,i),this.ad.subscribe(this.proxyListeners[e],e,i)}catch(t){this.main.log3rdPartyException(this.adResponse,"proxySubscribe",t)}},VPAIDWrapper.prototype.proxyUnsubscribe=function(t){try{this.proxyListeners[t]&&(this.ad.unsubscribe(this.proxyListeners[t],t),delete this.proxyListeners[t])}catch(t){this.main.log3rdPartyException(this.adResponse,"proxyUnsubscribe",t)}},VPAIDWrapper.prototype.addProxyListeners=function(){this.proxySubscribe(this.proxyAdLoaded,VPAIDEvent.AdLoaded,this),this.proxySubscribe(this.proxyAdStarted,VPAIDEvent.AdStarted,this),this.proxySubscribe(this.proxyAdStopped,VPAIDEvent.AdStopped,this),this.proxySubscribe(this.proxyAdSkipped,VPAIDEvent.AdSkipped,this),this.proxySubscribe(this.proxyAdLinearChange,VPAIDEvent.AdLinearChange,this),this.proxySubscribe(this.proxyAdSizeChange,VPAIDEvent.AdSizeChange,this),this.proxySubscribe(this.proxyAdExpandedChange,VPAIDEvent.AdExpandedChange,this),this.proxySubscribe(this.proxyAdSkippableStateChange,VPAIDEvent.AdSkippableStateChange,this),this.proxySubscribe(this.proxyAdRemainingTimeChange,VPAIDEvent.AdRemainingTimeChange,this),this.proxySubscribe(this.proxyAdDurationChange,VPAIDEvent.AdDurationChange,this),this.proxySubscribe(this.proxyAdVolumeChange,VPAIDEvent.AdVolumeChange,this),this.proxySubscribe(this.proxyAdImpression,VPAIDEvent.AdImpression,this),this.proxySubscribe(this.proxyAdVideoStart,VPAIDEvent.AdVideoStart,this),this.proxySubscribe(this.proxyAdVideoFirstQuartile,VPAIDEvent.AdVideoFirstQuartile,this),this.proxySubscribe(this.proxyAdVideoMidpoint,VPAIDEvent.AdVideoMidpoint,this),this.proxySubscribe(this.proxyAdVideoThirdQuartile,VPAIDEvent.AdVideoThirdQuartile,this),this.proxySubscribe(this.proxyAdVideoComplete,VPAIDEvent.AdVideoComplete,this),this.proxySubscribe(this.proxyAdClickThru,VPAIDEvent.AdClickThru,this),this.proxySubscribe(this.proxyAdInteraction,VPAIDEvent.AdInteraction,this),this.proxySubscribe(this.proxyAdUserAcceptInvitation,VPAIDEvent.AdUserAcceptInvitation,this),this.proxySubscribe(this.proxyAdUserMinimize,VPAIDEvent.AdUserMinimize,this),this.proxySubscribe(this.proxyAdUserClose,VPAIDEvent.AdUserClose,this),this.proxySubscribe(this.proxyAdPaused,VPAIDEvent.AdPaused,this),this.proxySubscribe(this.proxyAdPlaying,VPAIDEvent.AdPlaying,this),this.proxySubscribe(this.proxyAdLog,VPAIDEvent.AdLog,this),this.proxySubscribe(this.proxyAdError,VPAIDEvent.AdError,this)},VPAIDWrapper.prototype.removeProxyListeners=function(){this.proxyUnsubscribe(VPAIDEvent.AdLoaded),this.proxyUnsubscribe(VPAIDEvent.AdStarted),this.proxyUnsubscribe(VPAIDEvent.AdStopped),this.proxyUnsubscribe(VPAIDEvent.AdSkipped),this.proxyUnsubscribe(VPAIDEvent.AdLinearChange),this.proxyUnsubscribe(VPAIDEvent.AdSizeChange),this.proxyUnsubscribe(VPAIDEvent.AdExpandedChange),this.proxyUnsubscribe(VPAIDEvent.AdSkippableStateChange),this.proxyUnsubscribe(VPAIDEvent.AdRemainingTimeChange),this.proxyUnsubscribe(VPAIDEvent.AdDurationChange),this.proxyUnsubscribe(VPAIDEvent.AdVolumeChange),this.proxyUnsubscribe(VPAIDEvent.AdImpression),this.proxyUnsubscribe(VPAIDEvent.AdVideoStart),this.proxyUnsubscribe(VPAIDEvent.AdVideoFirstQuartile),this.proxyUnsubscribe(VPAIDEvent.AdVideoMidpoint),this.proxyUnsubscribe(VPAIDEvent.AdVideoThirdQuartile),this.proxyUnsubscribe(VPAIDEvent.AdVideoComplete),this.proxyUnsubscribe(VPAIDEvent.AdClickThru),this.proxyUnsubscribe(VPAIDEvent.AdInteraction),this.proxyUnsubscribe(VPAIDEvent.AdUserAcceptInvitation),this.proxyUnsubscribe(VPAIDEvent.AdUserMinimize),this.proxyUnsubscribe(VPAIDEvent.AdUserClose),this.proxyUnsubscribe(VPAIDEvent.AdPaused),this.proxyUnsubscribe(VPAIDEvent.AdPlaying),this.proxyUnsubscribe(VPAIDEvent.AdLog),this.proxyUnsubscribe(VPAIDEvent.AdError)},VPAIDWrapper.prototype.proxyAdLoaded=function(){this.emit(VPAIDEvent.AdLoaded)},VPAIDWrapper.prototype.proxyAdStarted=function(){this.emit(VPAIDEvent.AdStarted)},VPAIDWrapper.prototype.proxyAdStopped=function(){this.emit(VPAIDEvent.AdStopped)},VPAIDWrapper.prototype.proxyAdSkipped=function(){this.emit(VPAIDEvent.AdSkipped)},VPAIDWrapper.prototype.proxyAdLinearChange=function(){this.emit(VPAIDEvent.AdLinearChange)},VPAIDWrapper.prototype.proxyAdSizeChange=function(){this.emit(VPAIDEvent.AdSizeChange)},VPAIDWrapper.prototype.proxyAdExpandedChange=function(){this.emit(VPAIDEvent.AdExpandedChange)},VPAIDWrapper.prototype.proxyAdSkippableStateChange=function(){this.emit(VPAIDEvent.AdSkippableStateChange)},VPAIDWrapper.prototype.proxyAdRemainingTimeChange=function(){this.emit(VPAIDEvent.AdRemainingTimeChange)},VPAIDWrapper.prototype.proxyAdDurationChange=function(){this.emit(VPAIDEvent.AdDurationChange)},VPAIDWrapper.prototype.proxyAdVolumeChange=function(){this.emit(VPAIDEvent.AdVolumeChange)},VPAIDWrapper.prototype.proxyAdImpression=function(){this.emit(VPAIDEvent.AdImpression)},VPAIDWrapper.prototype.proxyAdVideoStart=function(){this.emit(VPAIDEvent.AdVideoStart)},VPAIDWrapper.prototype.proxyAdVideoFirstQuartile=function(){this.emit(VPAIDEvent.AdVideoFirstQuartile)},VPAIDWrapper.prototype.proxyAdVideoMidpoint=function(){this.emit(VPAIDEvent.AdVideoMidpoint)},VPAIDWrapper.prototype.proxyAdVideoThirdQuartile=function(){this.emit(VPAIDEvent.AdVideoThirdQuartile)},VPAIDWrapper.prototype.proxyAdVideoComplete=function(){this.emit(VPAIDEvent.AdVideoComplete)},VPAIDWrapper.prototype.proxyAdClickThru=function(t){this.emit(VPAIDEvent.AdClickThru,t&&t.data)},VPAIDWrapper.prototype.proxyAdInteraction=function(){this.emit(VPAIDEvent.AdInteraction)},VPAIDWrapper.prototype.proxyAdUserAcceptInvitation=function(){this.emit(VPAIDEvent.AdUserAcceptInvitation)},VPAIDWrapper.prototype.proxyAdUserMinimize=function(){this.emit(VPAIDEvent.AdUserMinimize)},VPAIDWrapper.prototype.proxyAdUserClose=function(){this.emit(VPAIDEvent.AdUserClose)},VPAIDWrapper.prototype.proxyAdPaused=function(){this.emit(VPAIDEvent.AdPaused)},VPAIDWrapper.prototype.proxyAdPlaying=function(){this.emit(VPAIDEvent.AdPlaying)},VPAIDWrapper.prototype.proxyAdLog=function(){this.emit(VPAIDEvent.AdLog)},VPAIDWrapper.prototype.proxyAdError=function(){this.emit(VPAIDEvent.AdError)},VPAIDWrapper.prototype.getAdLinear=function(){try{return this.ad.getAdLinear()}catch(t){this.main.log3rdPartyException(this.adResponse,"getAdLinear",t)}},VPAIDWrapper.prototype.getAdWidth=function(){try{return this.ad.getAdWidth()}catch(t){this.main.log3rdPartyException(this.adResponse,"getAdWidth",t)}return 400},VPAIDWrapper.prototype.getAdHeight=function(){try{return this.ad.getAdHeight()}catch(t){this.main.log3rdPartyException(this.adResponse,"getAdHeight",t)}return 300},VPAIDWrapper.prototype.getAdExpanded=function(){try{return this.ad.getAdExpanded()}catch(t){this.main.log3rdPartyException(this.adResponse,"getAdExpanded",t)}return!1},VPAIDWrapper.prototype.getAdSkippableState=function(){try{return this.ad.getAdSkippableState()}catch(t){this.main.log3rdPartyException(this.adResponse,"getAdSkippableState",t)}return!1},VPAIDWrapper.prototype.getAdRemainingTime=function(){try{return this.ad.getAdRemainingTime()}catch(t){this.main.log3rdPartyException(this.adResponse,"getAdRemainingTime",t)}return 0},VPAIDWrapper.prototype.getAdDuration=function(){if(!isNaN(this.overrideAdDurationOnException))return this.overrideAdDurationOnException;try{return this.ad.getAdDuration()}catch(t){this.main.log3rdPartyException(this.adResponse,"getAdDuration",t),this.overrideAdDurationOnException=-1}return-1},VPAIDWrapper.prototype.getAdVolume=function(){try{return this.ad.getAdVolume()}catch(t){this.main.log3rdPartyException(this.adResponse,"getAdVolume",t)}return 1},VPAIDWrapper.prototype.setAdVolume=function(t,e){try{if(t!==this.getAdVolume()&&(this.prevAdVolume=this.getAdVolume(),this.ad.setAdVolume(t),e&&this.videoSlot)){var i=this.videoSlot.paused;this.videoSlot.muted=0===t,!i&&this.videoSlot.paused&&this.videoSlot.play()}}catch(t){this.main.log3rdPartyException(this.adResponse,"setAdVolume",t)}},VPAIDWrapper.prototype.getAdCompanions=function(){try{return this.ad.getAdCompanions()}catch(t){this.main.log3rdPartyException(this.adResponse,"getAdCompanions",t)}return""},VPAIDWrapper.prototype.getAdIcons=function(){try{return this.ad.getAdIcons()}catch(t){this.main.log3rdPartyException(this.adResponse,"getAdIcons",t)}return!1},VPAIDWrapper.prototype.handshakeVersion=function(t){try{return this.ad.handshakeVersion(t)}catch(t){this.main.log3rdPartyException(this.adResponse,"handshakeVersion",t)}return""},VPAIDWrapper.prototype.initAd=function(t,e,i,r,o,s){try{this.ad.initAd(t,e,i,r,o,s)}catch(t){this.main.log3rdPartyException(this.adResponse,"initAd",t)}},VPAIDWrapper.prototype.resizeAd=function(t,e,i){try{this.ad.resizeAd(t,e,i)}catch(t){this.main.log3rdPartyException(this.adResponse,"resizeAd",t)}},VPAIDWrapper.prototype.startAd=function(){try{this.ad.startAd()}catch(t){this.main.log3rdPartyException(this.adResponse,"startAd",t)}},VPAIDWrapper.prototype.stopAd=function(){if(this.stopAdCalled)return void this.emit(VPAIDEvent.AdStopped);this.stopAdCalled=!0,this.main.adDurationTimer&&this.main.loadedAdResponse&&this.main.loadedAdResponse.serverOrder===this.adResponse.serverOrder&&this.main.adDurationTimer.stop(),this.subscribe(this.adStopped,VPAIDEvent.AdStopped,this),this.stopAdTimer=new Timer(3e3,1),this.stopAdTimer.on(Timer.TIMER_COMPLETE,this.onStopAdTimeout,this),this.stopAdTimer.start();try{this.ad.stopAd()}catch(t){this.main.log3rdPartyException(this.adResponse,"stopAd",t)}},VPAIDWrapper.prototype.onStopAdTimeout=function(){this.unsubscribe(this.adStopped,VPAIDEvent.AdStopped),this.emit(VPAIDEvent.AdStopped)},VPAIDWrapper.prototype.adStopped=function(){this.unsubscribe(this.adStopped,VPAIDEvent.AdStopped),this.stopAdTimer.stop(),this.stopAdTimer.off(Timer.TIMER_COMPLETE,this.onStopAdTimeout),this.timer=new Timer(3e3,1),this.timer.on(Timer.TIMER_COMPLETE,this.removeProxyListeners,this),this.timer.start()},VPAIDWrapper.prototype.pauseAd=function(){try{this.ad.pauseAd()}catch(t){this.main.log3rdPartyException(this.adResponse,"pauseAd",t)}},VPAIDWrapper.prototype.resumeAd=function(){try{this.ad.resumeAd()}catch(t){this.main.log3rdPartyException(this.adResponse,"resumeAd",t)}},VPAIDWrapper.prototype.expandAd=function(){try{this.ad.expandAd()}catch(t){this.main.log3rdPartyException(this.adResponse,"expandAd",t)}},VPAIDWrapper.prototype.collapseAd=function(){try{this.ad.collapseAd()}catch(t){this.main.log3rdPartyException(this.adResponse,"collapseAd",t)}},VPAIDWrapper.prototype.skipAd=function(){try{this.ad.skipAd()}catch(t){this.main.log3rdPartyException(this.adResponse,"skipAd",t)}},VPAIDWrapper.prototype.subscribe=function(t,e,i){this.on(e,t,i)},VPAIDWrapper.prototype.unsubscribe=function(t,e){this.off(e,t)};
},{"../dev/Debug":7,"../events/SmokeSignals":8,"../util/Timer":15,"../util/Util":16,"../vpaid/VPAIDEvent":18}],20:[function(require,module,exports){
"use strict";function AdResponse(){this.init.apply(this,arguments)}exports.AdResponse=AdResponse;var Util=require("../util/Util").Util,Bid=require("../xml/Bid").Bid,LinearCreative=require("../xml/LinearCreative").LinearCreative;AdResponse.prototype.tag,AdResponse.prototype.serverOrder,AdResponse.prototype.playOrder,AdResponse.prototype.alreadyProcessed,AdResponse.prototype.alreadyPlayed,AdResponse.prototype.errors,AdResponse.prototype.impressions,AdResponse.prototype.isInLine,AdResponse.prototype.inLineLinearCreatives,AdResponse.prototype.isWrapper,AdResponse.prototype.wrapperUrl,AdResponse.prototype.wrapperLinearCreative,AdResponse.prototype.elapsedTime,AdResponse.prototype.status,AdResponse.prototype.bid,AdResponse.prototype.error,AdResponse.prototype.results,AdResponse.prototype.hasInsecureURLs,AdResponse.prototype.playedUsingFlashWrapper,AdResponse.prototype.init=function(e,s){this.tag=e,this.serverOrder=s,this.playOrder=0,this.alreadyProcessed=!1,this.alreadyPlayed=!1,this.errors=[],this.impressions=[],this.isInLine=!1,this.inLineLinearCreatives=[],this.isWrapper=!1,this.wrapperUrl="",this.wrapperLinearCreative=null,this.elapsedTime=0,this.status="",this.bid=null,this.error="",this.results=[],this.hasInsecureURLs=Util.isURLInsecure(this.tag.url),this.playedUsingFlashWrapper=!1},AdResponse.prototype.processXML=function(e){var s=e.documentElement;this.isInLine=!1,this.isWrapper=!1,this.wrapperUrl="";var i,r,t,a,n,o,p,h,l,d;if("VAST"===s.tagName){for(this.appendErrorsAndImpressions(s),i=0;i<s.childNodes.length;i++)if(a=s.childNodes[i],"Ad"===a.tagName){p=a;break}if(p){for(i=0;i<p.childNodes.length;i++)if(a=p.childNodes[i],"Wrapper"===a.tagName){h=a;break}if(h){for(this.isWrapper=!0,i=0;i<h.childNodes.length;i++)if(a=h.childNodes[i],"VASTAdTagURI"===a.tagName){this.wrapperUrl=a.textContent.trim(),this.hasInsecureURLs=this.hasInsecureURLs||Util.isURLInsecure(this.wrapperUrl);break}null===this.bid&&(this.bid=Bid.parse(h)),this.appendErrorsAndImpressions(h);e:for(i=0;i<h.childNodes.length;i++)if(a=h.childNodes[i],"Creatives"===a.tagName)for(r=0;r<a.childNodes.length;r++)if(n=a.childNodes[r],"Creative"===n.tagName)for(t=0;t<n.childNodes.length;t++)if(o=n.childNodes[t],"Linear"===o.tagName){d=o;break e}d&&(null===this.wrapperLinearCreative?this.wrapperLinearCreative=new LinearCreative(d):this.wrapperLinearCreative.appendTracking(new LinearCreative(d)),this.hasInsecureURLs=this.hasInsecureURLs||this.wrapperLinearCreative.hasInsecureURLs)}else{for(i=0;i<p.childNodes.length;i++)if(a=p.childNodes[i],"InLine"===a.tagName){l=a;break}if(l)for(this.isInLine=!0,null===this.bid&&(this.bid=Bid.parse(l)),this.appendErrorsAndImpressions(l),i=0;i<l.childNodes.length;i++)if(a=l.childNodes[i],"Creatives"===a.tagName)for(r=0;r<a.childNodes.length;r++)if(n=a.childNodes[r],"Creative"===n.tagName)for(t=0;t<n.childNodes.length;t++)if(o=n.childNodes[t],"Linear"===o.tagName){var L=new LinearCreative(o);this.hasInsecureURLs=this.hasInsecureURLs||L.hasInsecureURLs,this.inLineLinearCreatives.push(L);break}}}}},AdResponse.prototype.appendErrorsAndImpressions=function(e){for(var s=e.childNodes,i=0;i<s.length;i++){var r=s[i];if("Error"===r.tagName){var t=r.textContent.trim();this.hasInsecureURLs=this.hasInsecureURLs||Util.isURLInsecure(t),this.errors.push(t)}else if("Impression"===r.tagName){var a=r.textContent.trim();this.hasInsecureURLs=this.hasInsecureURLs||Util.isURLInsecure(a),this.impressions.push(a)}}},AdResponse.prototype.getProbablyPlayableCreatives=function(){var e=[];if(this.isInLine)for(var s=0;s<this.inLineLinearCreatives.length;s++){var i=this.inLineLinearCreatives[s];i.getProbablyPlayableMediaFiles().length>0&&e.push(i)}return e},AdResponse.prototype.getMaybePlayableCreatives=function(){var e=[];if(this.isInLine)for(var s=0;s<this.inLineLinearCreatives.length;s++){var i=this.inLineLinearCreatives[s];i.getMaybePlayableMediaFiles().length>0&&e.push(i)}return e},AdResponse.prototype.getFlashPlayableCreatives=function(e){var s=[];if(this.isInLine)for(var i=0;i<this.inLineLinearCreatives.length;i++){var r=this.inLineLinearCreatives[i];r.getFlashPlayableMediaFiles(e).length>0&&s.push(r)}return s},AdResponse.prototype.getVPAIDCreatives=function(){var e=[];if(this.isInLine)for(var s=0;s<this.inLineLinearCreatives.length;s++){var i=this.inLineLinearCreatives[s];i.getVPAIDMediaFiles().length>0&&e.push(i)}return e},AdResponse.prototype.getVPAIDFlashCreatives=function(e){var s=[];if(this.isInLine)for(var i=0;i<this.inLineLinearCreatives.length;i++){var r=this.inLineLinearCreatives[i];r.getVPAIDFlashMediaFiles(e).length>0&&s.push(r)}return s},AdResponse.prototype.getAllSupportedCreatives=function(e){var s,i,r=this.getProbablyPlayableCreatives(),t=this.getMaybePlayableCreatives();for(i=0;i<t.length;i++)s=t[i],-1===r.indexOf(s)&&r.push(s);for(t=this.getFlashPlayableCreatives(e),i=0;i<t.length;i++)s=t[i],-1===r.indexOf(s)&&r.push(s);for(t=this.getVPAIDCreatives(),i=0;i<t.length;i++)s=t[i],-1===r.indexOf(s)&&r.push(s);for(t=this.getVPAIDFlashCreatives(e),i=0;i<t.length;i++)s=t[i],-1===r.indexOf(s)&&r.push(s);return r};
},{"../util/Util":16,"../xml/Bid":21,"../xml/LinearCreative":22}],21:[function(require,module,exports){
"use strict";function Bid(){this.init.apply(this,arguments)}exports.Bid=Bid,Bid.prototype.model,Bid.prototype.currency,Bid.prototype.value,Bid.prototype.init=function(t,i,e){this.model=t,this.currency=i,this.value=e},Bid.parse=function(t){for(var i=0;i<t.childNodes.length;i++){var e=t.childNodes[i];if("Pricing"===e.tagName){var r=e.getAttribute("model"),n=e.getAttribute("currency"),o=e.textContent.trim();if(r&&n&&o)return new Bid(r,n,o);break}}return null};
},{}],22:[function(require,module,exports){
"use strict";function LinearCreative(){this.init.apply(this,arguments)}exports.LinearCreative=LinearCreative;var Util=require("../util/Util").Util,MediaFile=require("../xml/MediaFile").MediaFile,Tracking=require("../xml/Tracking").Tracking;LinearCreative.prototype.adParameters,LinearCreative.prototype.mediaFiles,LinearCreative.prototype.trackingEvents,LinearCreative.prototype.videoClicksThrough,LinearCreative.prototype.videoClicksTracking,LinearCreative.prototype.customVideoClicks,LinearCreative.prototype.hasInsecureURLs,LinearCreative.prototype.init=function(e){this.adParameters="",this.mediaFiles=[],this.trackingEvents=[],this.videoClicksThrough=[],this.videoClicksTracking=[],this.customVideoClicks=[],this.hasInsecureURLs=!1;for(var i,t,s,a,i=0;i<e.childNodes.length;i++)if(s=e.childNodes[i],"AdParameters"===s.tagName)this.adParameters=s.textContent.trim(),"true"===s.getAttribute("xmlEncoded")&&(this.adParameters=decodeURIComponent(this.adParameters));else if("MediaFiles"===s.tagName){for(var t=0;t<s.childNodes.length;t++)if(a=s.childNodes[t],"MediaFile"===a.tagName){var r=new MediaFile(a);this.hasInsecureURLs=this.hasInsecureURLs||r.hasInsecureURLs,this.mediaFiles.push(r)}}else if("TrackingEvents"===s.tagName){for(var t=0;t<s.childNodes.length;t++)if(a=s.childNodes[t],"Tracking"===a.tagName){var n=new Tracking(a);this.hasInsecureURLs=this.hasInsecureURLs||n.hasInsecureURLs,this.trackingEvents.push(n)}}else if("VideoClicks"===s.tagName)for(var t=0;t<s.childNodes.length;t++)if(a=s.childNodes[t],"ClickThrough"===a.tagName)this.videoClicksThrough.push(a.textContent.trim());else if("ClickTracking"===a.tagName){var h=a.textContent.trim();this.hasInsecureURLs=this.hasInsecureURLs||Util.isURLInsecure(h),this.videoClicksTracking.push(h)}else if("CustomClick"===a.tagName){var l=a.textContent.trim();this.hasInsecureURLs=this.hasInsecureURLs||Util.isURLInsecure(l),this.customVideoClicks.push(l)}},LinearCreative.prototype.appendTracking=function(e){this.trackingEvents=this.trackingEvents.concat(e.trackingEvents),this.videoClicksThrough=this.videoClicksThrough.concat(e.videoClicksThrough),this.videoClicksTracking=this.videoClicksTracking.concat(e.videoClicksTracking),this.customVideoClicks=this.customVideoClicks.concat(e.customVideoClicks),this.hasInsecureURLs=this.hasInsecureURLs||e.hasInsecureURLs},LinearCreative.prototype.getProbablyPlayableMediaFiles=function(){for(var e=[],i=0;i<this.mediaFiles.length;i++){var t=this.mediaFiles[i];t.isProbablyPlayable()&&e.push(t)}return e},LinearCreative.prototype.getMaybePlayableMediaFiles=function(){for(var e=[],i=0;i<this.mediaFiles.length;i++){var t=this.mediaFiles[i];t.isMaybePlayable()&&e.push(t)}return e},LinearCreative.prototype.getFlashPlayableMediaFiles=function(e){for(var i=[],t=0;t<this.mediaFiles.length;t++){var s=this.mediaFiles[t];s.isFlashPlayable(e)&&i.push(s)}return i},LinearCreative.prototype.getVPAIDMediaFiles=function(){for(var e=[],i=0;i<this.mediaFiles.length;i++){var t=this.mediaFiles[i];t.isVPAID()&&e.push(t)}return e},LinearCreative.prototype.getVPAIDFlashMediaFiles=function(e){for(var i=[],t=0;t<this.mediaFiles.length;t++){var s=this.mediaFiles[t];s.isVPAIDFlash(e)&&i.push(s)}return i},LinearCreative.prototype.hasSupportedMediaFiles=function(e){return this.getProbablyPlayableMediaFiles().length>0||this.getMaybePlayableMediaFiles().length>0||this.getVPAIDMediaFiles().length>0||this.getFlashPlayableMediaFiles(e).length>0||this.getVPAIDFlashMediaFiles(e).length>0};
},{"../util/Util":16,"../xml/MediaFile":23,"../xml/Tracking":24}],23:[function(require,module,exports){
"use strict";function MediaFile(){this.init.apply(this,arguments)}exports.MediaFile=MediaFile;var Config=require("../app/Config").Config,Util=require("../util/Util").Util;MediaFile.dummyVideoElement=document.createElement("video"),MediaFile.prototype.id,MediaFile.prototype.delivery,MediaFile.prototype.type,MediaFile.prototype.bitrate,MediaFile.prototype.minBitrate,MediaFile.prototype.maxBitrate,MediaFile.prototype.width,MediaFile.prototype.height,MediaFile.prototype.scalable,MediaFile.prototype.maintainAspectRatio,MediaFile.prototype.codec,MediaFile.prototype.apiFramework,MediaFile.prototype.url,MediaFile.prototype.onlyFlash,MediaFile.prototype.hasInsecureURLs,MediaFile.prototype.init=function(t){this.id=t.getAttribute("id"),this.delivery=t.getAttribute("delivery"),this.type=t.getAttribute("type"),this.bitrate=parseInt(t.getAttribute("bitrate")),isNaN(this.bitrate)&&(this.bitrate=0),this.minBitrate=t.getAttribute("minBitrate"),isNaN(this.minBitrate)&&(this.minBitrate=0),this.maxBitrate=t.getAttribute("maxBitrate"),isNaN(this.maxBitrate)&&(this.maxBitrate=0),this.width=parseInt(t.getAttribute("width")),isNaN(this.width)&&(this.width=0),this.height=parseInt(t.getAttribute("height")),isNaN(this.height)&&(this.height=0),this.scalable=t.getAttribute("scalable"),this.maintainAspectRatio=t.getAttribute("maintainAspectRatio"),this.codec=t.getAttribute("codec"),null===this.codec&&(this.codec=""),this.apiFramework=t.getAttribute("apiFramework"),this.url=t.textContent.trim(),this.onlyFlash=!1,this.hasInsecureURLs=Util.isURLInsecure(this.url)},MediaFile.prototype.isProbablyPlayable=function(){return!this.onlyFlash&&this.type&&MediaFile.dummyVideoElement.canPlayType&&"probably"===MediaFile.dummyVideoElement.canPlayType(this.type+'; codecs="'+this.codec+'"')},MediaFile.prototype.isMaybePlayable=function(){return!this.onlyFlash&&this.type&&MediaFile.dummyVideoElement.canPlayType&&"maybe"===MediaFile.dummyVideoElement.canPlayType(this.type+'; codecs="'+this.codec+'"')},MediaFile.prototype.isFlashPlayable=function(t){return(Config.FLASH||t)&&("video/x-flv"===this.type||"video/mp4"===this.type)},MediaFile.prototype.isVPAID=function(){return!this.onlyFlash&&"VPAID"===this.apiFramework&&"application/javascript"===this.type},MediaFile.prototype.isVPAIDFlash=function(t){return(Config.FLASH||t)&&"VPAID"===this.apiFramework&&"application/x-shockwave-flash"===this.type};
},{"../app/Config":5,"../util/Util":16}],24:[function(require,module,exports){
"use strict";function Tracking(){this.init.apply(this,arguments)}exports.Tracking=Tracking;var Util=require("../util/Util").Util;Tracking.REGEX_SECONDS=/^[0-2][0-9]:[0-5][0-9]:[0-5][0-9]$/,Tracking.REGEX_MILLISECONDS=/^[0-2][0-9]:[0-5][0-9]:[0-5][0-9]\.[0-9]{3}$/,Tracking.REGEX_PERCENTAGE=/^[0-9]{1,3}%$/,Tracking.prototype.event,Tracking.prototype.url,Tracking.prototype.milliseconds,Tracking.prototype.percentage,Tracking.prototype.fired,Tracking.prototype.hasInsecureURLs,Tracking.prototype.init=function(t){if(this.event=t.getAttribute("event"),this.url=t.textContent.trim(),this.milliseconds=-1,this.percentage=-1,this.fired=!1,"progress"===this.event){var e,r,s,i,n=t.getAttribute("offset"),a=n.match(Tracking.REGEX_SECONDS);if(null!==a&&a.length>0)(e=parseInt(n.substr(0,2)))<24&&(r=parseInt(n.substr(3,2)),s=parseInt(n.substr(6,2)),this.milliseconds=1e3*(60*(60*e+r)+s));else{var c=n.match(Tracking.REGEX_MILLISECONDS);if(null!==c&&c.length>0)(e=parseInt(n.substr(0,2)))<24&&(r=parseInt(n.substr(3,2)),s=parseInt(n.substr(6,2)),i=parseInt(n.substr(9,3)),this.milliseconds=1e3*(60*(60*e+r)+s)+i);else{var l=n.match(Tracking.REGEX_PERCENTAGE);if(null!==l&&l.length>0){var p=parseInt(n.substr(0,n.length-1));p<=100&&(this.percentage=p)}}}}this.hasInsecureURLs=Util.isURLInsecure(this.url)};
},{"../util/Util":16}]},{},[6]);
